<problem>
    <style type="text/css">
        .task-inputs-block .message, .task-inputs-block .response_message {
            /*display: inline-block !important;*/
            background: whitesmoke !important;
            padding: 10px !important;
            margin-top: 8px !important;
            box-shadow: 0px 0px 1px 1px #d0d5dd !important;
            font-weight: bold !important;
        }

        .task-inputs-block p {
            margin-bottom: 0.41575em !important;
        }

        .task-text code {
            white-space: normal !important;
        }

    </style>
    <script type="loncapa/python">
def comparison_numbers(correct_number, student_number, tol=0.001):
    if type(student_number) == str:
        student_number = student_number.replace(",", ".")
    try:
        st_num = float(student_number)
        return tol >= abs(st_num - correct_number)
    except ValueError:
        return False


def check_answer(expect, answer_given):
    grade = 10
    max_grade = 10
    user_state = [
        {
            "answer": answer_given[0],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[1],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[2],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[3],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[4],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[5],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[6],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[7],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[8],
            "msg": "",
            "correctness": True
        },
        {
            "answer": answer_given[9],
            "msg": "",
            "correctness": True
        }
    ]
    overall_message = ''
    all_numbers = True
    try:
        for ix_ind, x in enumerate(user_state):
            if ix_ind in [5]:
                user_state[ix_ind]["ans_int"] = str(x["answer"])
            else:
                user_state[ix_ind]["ans_int"] = float(x["answer"])

    except ValueError:
        for idx, s in enumerate(user_state):
            user_state[idx]['correctness'] = False
            overall_message = "Only numeric values are allowed in answers (exclude platforms input). Make sure all fields are filled correctly."
            all_numbers = False

    if all_numbers:
        if not comparison_numbers(1017, user_state[0]["ans_int"]):
            grade -= 1
            user_state[0]["correctness"] = False

        if not comparison_numbers(1021, user_state[1]["ans_int"]):
            grade -= 1
            user_state[1]["correctness"] = False

        if not comparison_numbers(1031, user_state[2]["ans_int"]):
            grade -= 1
            user_state[2]["correctness"] = False

        if not comparison_numbers(1049, user_state[3]["ans_int"]):
            grade -= 1
            user_state[3]["correctness"] = False

        if not comparison_numbers(1054, user_state[4]["ans_int"]):
            grade -= 1
            user_state[4]["correctness"] = False

        if not ('ios' in user_state[5]["ans_int"].lower() and 'android' in user_state[5]["ans_int"].lower()):
            grade -= 1
            user_state[5]["correctness"] = False

        if not comparison_numbers(1602, user_state[6]["ans_int"]):
            grade -= 1
            user_state[6]["correctness"] = False

        if not comparison_numbers(1020, user_state[7]["ans_int"]):
            grade -= 1
            user_state[7]["correctness"] = False

        if not comparison_numbers(1190, user_state[8]["ans_int"]):
            grade -= 1
            user_state[8]["correctness"] = False

        if not comparison_numbers(1600, user_state[9]["ans_int"]):
            grade -= 1
            user_state[9]["correctness"] = False
    if 0 > grade:
        grade = 0

    return {'overall_message': str(overall_message),
            'input_list': [
                {'ok': user_state[0]['correctness'], 'msg': user_state[0]['msg'], 'grade_decimal':grade/max_grade},
                {'ok': user_state[1]['correctness'], 'msg': user_state[1]['msg'], 'grade_decimal':grade/max_grade},
                {'ok': user_state[2]['correctness'], 'msg': user_state[2]['msg'], 'grade_decimal':grade/max_grade},
                {'ok': user_state[3]['correctness'], 'msg': user_state[3]['msg'], 'grade_decimal':grade/max_grade},
                {'ok': user_state[4]['correctness'], 'msg': user_state[4]['msg'], 'grade_decimal': grade/max_grade},
                {'ok': user_state[5]['correctness'], 'msg': user_state[5]['msg'], 'grade_decimal': grade/max_grade},
                {'ok': user_state[6]['correctness'], 'msg': user_state[5]['msg'], 'grade_decimal': grade / max_grade},
                {'ok': user_state[7]['correctness'], 'msg': user_state[5]['msg'], 'grade_decimal': grade / max_grade},
                {'ok': user_state[8]['correctness'], 'msg': user_state[5]['msg'], 'grade_decimal': grade / max_grade},
                {'ok': user_state[9]['correctness'], 'msg': user_state[5]['msg'], 'grade_decimal': grade / max_grade}
            ]}

</script>

    <script type="text/javascript">
        document.querySelectorAll('.problem-progress').forEach(function(userItem) {
            function second_passed() {
                let arr = userItem.innerHTML.split(" ")
                arr[0] = Math.round(parseFloat(arr[0].split("/")[0]))+'/'+Math.round(parseFloat(arr[0].split("/")[1]))
                userItem.innerHTML = arr.join(" ")
            }
            setTimeout(second_passed, 300)
        });
    </script>

    <div class="task-text">
        <ol>
            <li>Using the reference information at <a href="https://attack.mitre.org/" target="_blank">https://attack.mitre.org/</a> determine the mitigation measures for the «Phishing» technique and their IDs in the Mitre system. Enter their IDs in the relevant fields on the lab page (in ascending order of identifiers).</li>
            <li>Using the reference information at <a href="https://attack.mitre.org/" target="_blank">https://attack.mitre.org/</a> determine which platforms are threatened by the «Capture Camera» technique. Enter their names in the relevant fields on the lab page.</li>
            <li>Download the <a href="/static/L2_Mitre_Layer.json" download="L2_Mitre_Layer.json">«L2_Mitre_Layer.json»</a> file from the lab materials.</li>
            <li>Open it using <a href="https://mitre-attack.github.io/attack-navigator/" target="_blank">https://mitre-attack.github.io/attack-navigator/</a>.</li>
            <li>Analyze the presented matrix.</li>
            <li>Determine which two techniques in the matrix have the highest score and which two have the lowest score. Enter their IDs in the relevant fields on the lab page in descending score order (score order, not identifiers).</li>
        </ol>
    </div>

    <div class="task-inputs-block">
        <customresponse cfn="check_answer">
            <p>Enter IDs of the mitigation measures for «Phishing» technique (without the first letter «M»):</p>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <hr />
            <div class="input-block">
                <p>Enter platforms for which the «Capture Camera» technique poses a threat:</p>
                <textline size="10" label=""/><br />
            </div>

            <hr />
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>
            <div class="input-block">
                <textline size="10" label=""/><br />
            </div>

        </customresponse>
        <solution>
            <div class="detailed-solution">
                <p><strong>Correct answer: </strong></p>
                <p><strong>1017</strong></p>
                <p><strong>1021</strong></p>
                <p><strong>1031</strong></p>
                <p><strong>1049</strong></p>
                <p><strong>1054</strong></p>
                <p><strong>android, ios</strong></p>
                <p><strong>1602</strong></p>
                <p><strong>1020</strong></p>
                <p><strong>1190</strong></p>
                <p><strong>1600</strong></p>
            </div>

        </solution>
    </div>
</problem>