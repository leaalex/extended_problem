<problem>
    <script type="loncapa/python">
import random
import json

# import sys
# reload(sys)
# sys.setdefaultencoding('utf8')

variants = [
    {
        "source_filepath": "/static/variant_xxx.xlsx",
        "source_template_filepath": "/static/variant_xxx.xlsx",
        "answer": '''
        [["Внешняя освещенность", "Номер дня в году", "Угол солнечного сколнения", "Долгота", "Широта", "Температура воздуха", "Влажность воздуха", "Видимость", "День", "Месяц", "Час", "Минуты" ], [ "0.631", "327", "-20.82494422", "58.475", "51.266", "1", "0.8795", "10", "23", "11", "0", "30" ], [ "0.655", "327", "-20.82494422", "58.475", "51.266", "1", "0.8755", "10", "23", "11", "1", "0" ], [ "0.562", "327", "-20.82494422", "58.475", "51.266", "0", "0.8707", "10", "23", "11", "2", "0" ], [ "0.513", "327", "-20.82494422", "58.475", "51.266", "0", "0.867", "10", "23", "11", "2", "30" ], [ "0.555", "327", "-20.82494422", "58.475", "51.266", "0", "0.8627", "10", "23", "11", "3", "0" ], [ "0.641", "327", "-20.82494422", "58.475", "51.266", "0", "0.8798", "10", "23", "11", "3", "30" ], [ "0.527", "327", "-20.82494422", "58.475", "51.266", "0", "0.8731", "10", "23", "11", "4", "0" ], [ "0.562", "327", "-20.82494422", "58.475", "51.266", "0", "0.8684", "10", "23", "11", "4", "30" ], [ "0.549", "327", "-20.82494422", "58.475", "51.266", "-1", "0.9287", "10", "23", "11", "5", "0" ], [ "0.515", "327", "-20.82494422", "58.475", "51.266", "-1", "0.9314", "10", "23", "11", "5", "30" ], [ "0.583", "327", "-20.82494422", "58.475", "51.266", "-1", "0.9396", "10", "23", "11", "6", "0" ], [ "0.531", "327", "-20.82494422", "58.475", "51.266", "-1", "0.9268", "10", "23", "11", "6", "30" ], [ "0.674", "327", "-20.82494422", "58.475", "51.266", "1", "0.877", "10", "23", "11", "7", "0" ], [ "0.515", "327", "-20.82494422", "58.475", "51.266", "1", "0.8742", "10", "23", "11", "7", "30" ], [ "0.622", "327", "-20.82494422", "58.475", "51.266", "0", "0.81", "10", "23", "11", "8", "0" ], [ "0.673", "327", "-20.82494422", "58.475", "51.266", "0", "0.7909", "10", "23", "11", "8", "30" ], [ "122.726", "327", "-20.82494422", "58.475", "51.266", "0", "0.5995", "10", "23", "11", "15", "0" ], [ "117.457", "327", "-20.82494422", "58.475", "51.266", "0", "0.6022", "10", "23", "11", "15", "30" ], [ "91.621", "327", "-20.82494422", "58.475", "51.266", "0", "0.5979", "10", "23", "11", "16", "0" ], [ "63.447", "328", "-21.00743137", "58.475", "51.266", "1", "0.803", "10", "24", "11", "10", "0" ], [ "100.049", "328", "-21.00743137", "58.475", "51.266", "1", "0.8108", "10", "24", "11", "10", "30" ], [ "74.613", "328", "-21.00743137", "58.475", "51.266", "1", "0.8668", "10", "24", "11", "14", "0" ], [ "58.265", "328", "-21.00743137", "58.475", "51.266", "1", "0.8607", "10", "24", "11", "14", "30" ], [ "52.51", "328", "-21.00743137", "58.475", "51.266", "1", "0.8631", "10", "24", "11", "15", "0" ], [ "36.363", "328", "-21.00743137", "58.475", "51.266", "1", "0.8746", "10", "24", "11", "15", "30" ], [ "34.296", "328", "-21.00743137", "58.475", "51.266", "1", "0.9211", "10", "24", "11", "16", "0" ], [ "16.969", "328", "-21.00743137", "58.475", "51.266", "1", "0.9291", "10", "24", "11", "16", "30" ], [ "5.356", "328", "-21.00743137", "58.475", "51.266", "1", "0.9389", "10", "24", "11", "17", "0" ], [ "1.046", "328", "-21.00743137", "58.475", "51.266", "1", "0.9291", "10", "24", "11", "17", "30" ], [ "0.61", "328", "-21.00743137", "58.475", "51.266", "1", "1.007", "10", "24", "11", "18", "0" ], [ "0.617", "328", "-21.00743137", "58.475", "51.266", "1", "1.0023", "7", "24", "11", "19", "30" ], [ "0.672", "328", "-21.00743137", "58.475", "51.266", "1", "1.0084", "10", "24", "11", "20", "0" ], [ "0.709", "328", "-21.00743137", "58.475", "51.266", "1", "0.9921", "10", "24", "11", "20", "30" ], [ "0.722", "328", "-21.00743137", "58.475", "51.266", "2", "0.9311", "10", "24", "11", "21", "0" ], [ "0.534", "328", "-21.00743137", "58.475", "51.266", "2", "0.9301", "10", "24", "11", "21", "30" ], [ "0.592", "328", "-21.00743137", "58.475", "51.266", "1", "1.0083", "10", "24", "11", "22", "0" ], [ "0.55", "328", "-21.00743137", "58.475", "51.266", "1", "0.9972", "10", "24", "11", "22", "30" ], [ "0.629", "328", "-21.00743137", "58.475", "51.266", "1", "0.994", "10", "24", "11", "23", "0" ], [ "0.524", "328", "-21.00743137", "58.475", "51.266", "1", "1.004", "10", "24", "11", "23", "30" ], [ "0.699", "329", "-21.18369356", "58.475", "51.266", "1", "0.9947", "10", "25", "11", "0", "0" ], [ "0.693", "329", "-21.18369356", "58.475", "51.266", "1", "1.0056", "10", "25", "11", "0", "30" ], [ "0.536", "329", "-21.18369356", "58.475", "51.266", "1", "0.9909", "7", "25", "11", "1", "0" ], [ "0.556", "329", "-21.18369356", "58.475", "51.266", "1", "0.9929", "7", "25", "11", "1", "30" ], [ "0.744", "329", "-21.18369356", "58.475", "51.266", "1", "1.0093", "2.5", "25", "11", "2", "0" ], [ "0.671", "329", "-21.18369356", "58.475", "51.266", "1", "0.9973", "2.5", "25", "11", "2", "30" ], [ "0.649", "329", "-21.18369356", "58.475", "51.266", "1", "1.0075", "0.4", "25", "11", "4", "0" ], [ "0.692", "329", "-21.18369356", "58.475", "51.266", "1", "1.0049", "0.4", "25", "11", "4", "30" ], [ "0.709", "329", "-21.18369356", "58.475", "51.266", "1", "0.9907", "2.5", "25", "11", "5", "0" ], [ "0.659", "329", "-21.18369356", "58.475", "51.266", "1", "0.9961", "2.5", "25", "11", "5", "30" ], [ "0.701", "329", "-21.18369356", "58.475", "51.266", "1", "1.0038", "2.5", "25", "11", "6", "0" ], [ "0.775", "329", "-21.18369356", "58.475", "51.266", "1", "0.9994", "2.5", "25", "11", "6", "30" ], [ "0.561", "329", "-21.18369356", "58.475", "51.266", "0", "1.0074", "0.5", "25", "11", "7", "0" ], [ "0.581", "329", "-21.18369356", "58.475", "51.266", "0", "1.009", "0.5", "25", "11", "7", "30" ], [ "1.604", "329", "-21.18369356", "58.475", "51.266", "0", "0.9958", "0.9", "25", "11", "9", "0" ], [ "6.003", "329", "-21.18369356", "58.475", "51.266", "0", "0.9916", "0.9", "25", "11", "9", "30" ], [ "10.84", "329", "-21.18369356", "58.475", "51.266", "1", "1.0078", "0.9", "25", "11", "10", "0" ], [ "25.489", "329", "-21.18369356", "58.475", "51.266", "1", "1.0022", "0.9", "25", "11", "10", "30" ], [ "45.026", "329", "-21.18369356", "58.475", "51.266", "1", "1.0006", "0.7", "25", "11", "11", "0" ], [ "33.936", "329", "-21.18369356", "58.475", "51.266", "1", "1.0006", "0.7", "25", "11", "11", "30" ], [ "49.52", "329", "-21.18369356", "58.475", "51.266", "1", "1.0091", "0.8", "25", "11", "12", "0" ], [ "33.522", "329", "-21.18369356", "58.475", "51.266", "1", "0.9982", "0.8", "25", "11", "12", "30" ], [ "42.882", "329", "-21.18369356", "58.475", "51.266", "1", "1.0006", "1.8", "25", "11", "13", "0" ], [ "29.69", "329", "-21.18369356", "58.475", "51.266", "1", "1.0014", "10", "25", "11", "14", "0" ], [ "55.45", "329", "-21.18369356", "58.475", "51.266", "1", "0.9931", "10", "25", "11", "14", "30" ], [ "51.28", "329", "-21.18369356", "58.475", "51.266", "1", "0.9941", "10", "25", "11", "15", "0" ], [ "23.473", "329", "-21.18369356", "58.475", "51.266", "1", "1.0022", "10", "25", "11", "15", "30" ], [ "14.787", "329", "-21.18369356", "58.475", "51.266", "1", "1.0045", "0.7", "25", "11", "16", "0" ], [ "9.784", "329", "-21.18369356", "58.475", "51.266", "1", "1.0073", "0.7", "25", "11", "16", "30" ], [ "3.544", "329", "-21.18369356", "58.475", "51.266", "1", "1.0073", "2.5", "25", "11", "17", "0" ], [ "0.738", "329", "-21.18369356", "58.475", "51.266", "1", "0.9961", "2.5", "25", "11", "17", "30" ], [ "0.526", "329", "-21.18369356", "58.475", "51.266", "1", "1.0017", "7", "25", "11", "18", "0" ], [ "0.714", "329", "-21.18369356", "58.475", "51.266", "1", "1.0076", "7", "25", "11", "18", "30" ], [ "0.515", "329", "-21.18369356", "58.475", "51.266", "0", "1.0053", "10", "25", "11", "19", "0" ], [ "0.725", "329", "-21.18369356", "58.475", "51.266", "0", "0.9951", "10", "25", "11", "19", "30" ], [ "0.527", "329", "-21.18369356", "58.475", "51.266", "0", "0.991", "10", "25", "11", "20", "0" ], [ "0.626", "329", "-21.18369356", "58.475", "51.266", "0", "1.0024", "10", "25", "11", "20", "30" ], [ "0.752", "329", "-21.18369356", "58.475", "51.266", "0", "1.0022", "7", "25", "11", "21", "0" ], [ "0.7", "329", "-21.18369356", "58.475", "51.266", "0", "1.0069", "7", "25", "11", "21", "30" ], [ "0.683", "329", "-21.18369356", "58.475", "51.266", "0", "0.9966", "0.8", "25", "11", "22", "0" ], [ "0.579", "329", "-21.18369356", "58.475", "51.266", "0", "0.9988", "0.8", "25", "11", "22", "30" ], [ "0.626", "329", "-21.18369356", "58.475", "51.266", "-1", "0.9907", "2", "25", "11", "23", "0" ], [ "0.592", "329", "-21.18369356", "58.475", "51.266", "-1", "0.9966", "2", "25", "11", "23", "30" ], [ "0.718", "330", "-21.35367858", "58.475", "51.266", "-1", "1.003", "7", "26", "11", "0", "30" ], [ "0.675", "330", "-21.35367858", "58.475", "51.266", "-1", "0.9247", "10", "26", "11", "1", "0" ], [ "0.584", "330", "-21.35367858", "58.475", "51.266", "-1", "0.9261", "10", "26", "11", "1", "30" ], [ "0.693", "330", "-21.35367858", "58.475", "51.266", "-2", "0.9318", "10", "26", "11", "2", "0" ], [ "0.521", "330", "-21.35367858", "58.475", "51.266", "-2", "0.9341", "10", "26", "11", "2", "30" ], [ "0.614", "330", "-21.35367858", "58.475", "51.266", "-3", "0.9357", "10", "26", "11", "3", "0" ], [ "0.422", "330", "-21.35367858", "58.475", "51.266", "-3", "0.9274", "10", "26", "11", "3", "30" ], [ "0.639", "330", "-21.35367858", "58.475", "51.266", "-4", "0.9284", "10", "26", "11", "4", "0" ], [ "0.504", "330", "-21.35367858", "58.475", "51.266", "-4", "0.9247", "10", "26", "11", "4", "30" ], [ "0.577", "330", "-21.35367858", "58.475", "51.266", "-5", "0.9914", "10", "26", "11", "5", "0" ], [ "0.594", "330", "-21.35367858", "58.475", "51.266", "-5", "0.997", "10", "26", "11", "5", "30" ], [ "0.638", "330", "-21.35367858", "58.475", "51.266", "-5", "0.9381", "7", "26", "11", "6", "0" ]]
        '''
    }

]
variant = random.choice(variants)
correct_answer = json.loads(variant["answer"])

student_data = {
    "source_filepath": variant["source_filepath"],
    "source_template_filepath": variant["source_filepath"],
    "error_text": "Ошибка в строке incorrect_row_num.",
    "result_label": "Результат",
    "uploaded_file_label": "Загруженный файл:",
    "select_file_label": "Выберите файл",
    "correct_row_label": "Правильная строка",
    "incorrect_row_label": "Ваша строка",
}
correct_data = {
    "answer_title": "Решение",
    "variant": variant,
    "download_label": "Загрузить файл с верным ответом",
    "correct_filename": "Правильный ответ.xlsx",
}

source_template_filepath = student_data["source_template_filepath"]
source_filepath = student_data["source_filepath"]

source_data = json.dumps(student_data)
source_data = source_data.replace('"', "'")
correct_data = json.dumps(correct_data)
correct_data = correct_data.replace('"', "'")

def comparison_numbers(correct_number, student_number, tol=0.05):
    if student_number is None:
        return False
    if type(student_number) == str:
        student_number = student_number.replace(",", ".")
    if type(correct_number) == str:
        correct_number = correct_number.replace(",", ".")
    try:
        st_num = float(student_number)
        cr_num = float(correct_number)
        return tol >= abs(st_num - cr_num)
    except ValueError:
        return False


def comparison_arrays(correct_array, student_array, tol=0.05):
    if len(correct_array) != len(student_array):
        return [False for x in correct_array]
    else:
        ret_arr = []
        for idx, c_a in enumerate(correct_array):
            if comparison_numbers(c_a, student_array[idx], tol):
                ret_arr.append(True)
            else:
                ret_arr.append(False)
        return ret_arr


def check_answer(exp, ans):
    tolerance = 0.01
    student_answer = json.loads(ans)['data']
    max_garde = 1
    grade = 1
    error = {
        "incorrect_row_num": 0,
        "correct_row": [],
        "incorrect_row": [],
    }
    msg = {
        "grade_decimal": 0,
        "grade": 0,
        "max_grade": max_garde,
    }

    for row_index, correct_row in enumerate(correct_answer):
        if row_index == 0:
            continue

        # incorrect rows len
        if row_index >= len(student_answer):
            error["incorrect_row_num"] = row_index + 1
            error["correct_row"] = correct_row
            error["incorrect_row"] = ['' for x in correct_row]
            msg["error"] = error
            grade = 0
            break

        # incorrect column len
        if len(correct_row) != len(student_answer[row_index]):
            error["incorrect_row_num"] = row_index + 1
            error["correct_row"] = correct_row
            if len(correct_row) > len(student_answer[row_index]):
                diff = len(correct_row) - len(student_answer[row_index])
                error["incorrect_row"] = student_answer[row_index] + ([''] * diff)
            else:
                error["incorrect_row"] = student_answer[row_index]
            msg["error"] = error
            grade = 0
            break

        # incorrect values or parse errors
        if not all(comparison_arrays(correct_row, student_answer[row_index], tolerance)):
            error["incorrect_row_num"] = row_index + 1
            error["correct_row"] = correct_row
            error["incorrect_row"] = student_answer[row_index]
            msg["error"] = error
            grade = 0
            break

    final_grade = grade / max_garde
    msg["grade_decimal"] = final_grade

    if final_grade == 1:
        ok = True
    elif final_grade == 0:
        ok = False
    else:
        ok = 'Partial'
    msg = json.dumps(msg, ensure_ascii=False).replace("\"", "'")
    return {'input_list': [{'ok': ok, 'msg': msg, 'grade_decimal': final_grade}, ]}

</script>

    <div>
        <p>Скачать <a href="/static/$source_filepath">файл с исходными данными</a>.</p>
        <p>Скачать <a href="/static/$source_template_filepath">файл с порядком и именами столбцов выходного файла</a>.</p>
        <p>Загрузите полученный после предобработки данных файл (<i>xlsx</i> формат):</p>
    </div>
    <div data-type="XLSXCheckerApp" class="adv-apps" data-initial-data='$source_data'></div>

    <div style="display: none !important;">
        <customresponse cfn="check_answer">
            <textline size="40" value="$task_id"/>
            <br/>
        </customresponse>
    </div>

    <solution data-initial-data='$correct_data'></solution>
</problem>