<meta charset="utf-8">
<title>VueDraggableResizable demo</title>
<script src="https://cdn.jsdelivr.net/npm/vue/dist/vue.js"></script>
<script src="./VueDraggableResizable.umd.js"></script>

<link rel="stylesheet" href="./VueDraggableResizable.css">
<link rel="stylesheet" href="./machinery_management_task_2.css">

<div id='slider_view'>
    <div v-bind:style="areaStyle">
        <template v-for="item in items">
            <vue-draggable-resizable :w="pixel_step*item.width" :x="pixel_step*item.x" :y="pixel_step*item.y"
                                     :h="pixel_step*item.height" @dragging="onDrag" @resizing="onResize"
                                     @activated="onActivated(item.id)" @deactivated="onDeactivated"
                                     :min-Height="pixel_step" :min-Width="pixel_step" :grid=[pixel_step,pixel_step]
                                     :parent="true"
                                     :z="item.z_index"
                                     v-bind:class="[item.type, 'machine-element']" v-bind:id="item.id">
                <div class="title-wrapper">

                    <div class="title-size" v-if="item.width > 1">
                        Длит.: {{item.width}}
                    </div>
                    <div class="title-size" v-else>
                       {{item.width}}
                    </div>


                    <div class="title" v-if="item.width > 1">
                        {{item.title}}
                    </div>
                    <div class="title" v-else>
                        {{getLastWord(item.title)}}
                    </div>
<!--                    <div>{{item.title}}</div>-->
                    <!--                    <p>Hello! I'm a flexible component. You can drag me around and you can resize me.<br>-->
                    <!--                        X: {{ x }} / Y: {{ y }} - Width: {{ width }} / Height: {{ height }}</p>-->
                </div>
            </vue-draggable-resizable>
        </template>
    </div>
</div>

<div id='slider_table' class="x-axis-labels" style="position: relative;
    background: linear-gradient(-90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / 40px 40px, linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / 40px 40px;
    height: 40px;
    width: 760px;">
    <template v-for="(item,index) in values">
        <vue-draggable-resizable class="axis-label" :resizable="false" :draggable="false" :w="pixel_step"
                                 :h="pixel_step" :x="index*pixel_step" :y="0" :grid=[pixel_step,pixel_step]
                                 :parent="true">
            <div class="label">{{item}}</div>
        </vue-draggable-resizable>
    </template>
</div>


<script>

    let z_indexes = {
        machine: 1,
        aggregate:10,
        node: 20,
        detail: 30,

    };

    let settings = {
        pixel_step: 40,
        area_height: 14,
        area_width: 19 + 5,
        data: [
            {
                type: "machine",
                id: "machine_1",
                duration: 6,
                title: "Машина",
                end_on: 6
            },
            {
                type: "aggregate",
                id: "aggregate_1",
                duration: 4,
                title: "Аггрегат",
                end_on: 10
            },
            {
                type: "node",
                id: "node_1",
                duration: 4,
                title: "Узел 1",
                end_on: 14
            },
            {
                type: "detail",
                id: "detail_1_1",
                duration: 3,
                title: "Деталь 1.1",
                end_on: 17
            },
            {
                type: "detail",
                id: "detail_1_2",
                duration: 2,
                title: "Деталь 1.2",
                end_on: 16
            },
            {
                type: "detail",
                id: "detail_1_3",
                duration: 4,
                title: "Деталь 1.3",
                end_on: 18
            },
            {
                type: "node",
                id: "node_2",
                duration: 5,
                title: "Узел 2",
                end_on: 15
            },
            {
                type: "detail",
                id: "detail_2_1",
                duration: 4,
                title: "Деталь 2.1",
                end_on: 19
            },
            {
                type: "detail",
                id: "detail_2_2",
                duration: 3,
                title: "Деталь 2.2",
                end_on: 18
            },
            {
                type: "detail",
                id: "detail_2_3",
                duration: 3,
                title: "Деталь 2.3",
                end_on: 18
            },
            {
                type: "node",
                id: "node_3",
                duration: 6,
                title: "Узел 3",
                end_on: 12
            },
            {
                type: "detail",
                id: "detail_3_1",
                duration: 2,
                title: "Деталь 3.1",
                end_on: 14
            },
            {
                type: "detail",
                id: "detail_3_2",
                duration: 1,
                title: "Деталь 3.2",
                end_on: 13
            },
            {
                type: "detail",
                id: "detail_3_3",
                duration: 4,
                title: "Деталь 3.3",
                end_on: 16
            },
            {
                type: "node",
                id: "node_4",
                duration: 3,
                title: "Узел 4",
                end_on: 9
            },
            {
                type: "detail",
                id: "detail_4_1",
                duration: 3,
                title: "Деталь 4.1",
                end_on: 12
            },
            {
                type: "detail",
                id: "detail_4_2",
                duration: 2,
                title: "Деталь 4.2",
                end_on: 11
            },
            {
                type: "detail",
                id: "detail_4_3",
                duration: 3,
                title: "Деталь 4.3",
                end_on: 12
            },
            {
                type: "detail",
                id: "detail_5",
                duration: 3,
                title: "Деталь 5",
                end_on: 9
            },
            {
                type: "detail",
                id: "detail_6",
                duration: 3,
                title: "Деталь 6",
                end_on: 9
            }
        ],
    };

    settings.data = settings.data.map(function (x, index) {
        x.z_index = z_indexes[x.type];
        x.height = 1;
        x.width = 3;
        x.x = 0;
        let calc_help = (Math.ceil((index + 1) / settings.area_height)) - 1;
        x.x = calc_help * 3;
        x.y = settings.area_height - 1 - index;
        if (index >= settings.area_height) {
            x.y = settings.area_height - (index - settings.area_height * calc_help + 1);
        }
        return x;
    });
    settings.data_obj = settings.data.reduce((acc, cur) => ({...acc, [cur.id]: cur}), {});


    // console.log(settings.data_obj);

    new Vue({
        el: '#slider_view',
        data: {
            data_obj: settings.data_obj,
            pixel_step: settings.pixel_step,
            items: settings.data.reverse(),
            current_element: undefined,
        },
        methods: {
            onResize: function (x, y, width, height) {
                this.width = width;
                this.height = height;
                this.x = x;
                this.y = y;
                this.data_obj[this.current_element].x = this.x / this.pixel_step;
                this.data_obj[this.current_element].y = this.y / this.pixel_step;
                this.data_obj[this.current_element].width = this.width / this.pixel_step;
                this.data_obj[this.current_element].height = this.height / this.pixel_step;
            },
            onDrag: function (x, y) {
                this.x = x;
                this.y = y;
                this.data_obj[this.current_element].x = this.x / this.pixel_step;
                this.data_obj[this.current_element].y = this.y / this.pixel_step;
                // console.log(this.data_obj[this.current_element])
            },
            onActivated(id) {
                this.current_element = id;
            },
            onDeactivated() {
                this.current_element = undefined;
            },
            getLastWord(l){
                return l.split(" ").slice(-1)[0]
            },
        },
        computed: {
            areaStyle: function () {
                return {
                    height: this.pixel_step * settings.area_height + "px",
                    width: this.pixel_step * settings.area_width + "px",
                    background: `linear-gradient(-90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / ${this.pixel_step}px ${this.pixel_step}px, linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / ${this.pixel_step}px ${this.pixel_step}px`,
                    position: "relative",
                    border: "1px solid blue",
                }
            },
        }
    });

    new Vue({
        el: '#slider_table',

        data: {
            values: Array.from({length: settings.area_width}, (v, k) => k + 1).reverse(),
            pixel_step: settings.pixel_step,
        },
        methods: {},
        computed: {
            areaStyle: function () {
                return {
                    height: settings.area_height + "px",
                    width: this.pixel_step * settings.area_width + "px",
                    background: `linear-gradient(-90deg, rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / ${this.pixel_step}px ${this.pixel_step}px, linear-gradient(rgba(0, 0, 0, 0.1) 1px, transparent 1px) 0% 0% / ${this.pixel_step}px ${this.pixel_step}px`,
                    position: "relative",
                    border: "1px solid blue",
                }
            },

        }
    })


</script>
