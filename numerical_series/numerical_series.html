<style type="text/css">

.task-wrap, .start-wrap, .result-wrap{
	    /*height: 680px;*/
    /* background: #f6f6f6; */
    
}

.task-wrap{
	height: 100%;
}

.start-wrap{
	height: 680px;
}

.result-wrap{
	height: 100%;
}

.start-wrap{
	display: flex; 
    justify-content: center; 
    align-items: center; 
	border: 6px double #046b99;
}

.check-button-wrap{
	text-align: center;
	margin: 20px 0px;
}

.start-button, .check-button{
    font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
    width: 8em;
    /*height: 50px; */
    background: #046b99;
    color: #ffffff;
    font-size: 1.6em;
    font-weight: normal;
    border: none;
}
.start-button:hover, .check-button:hover{
    /*font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
    width: 200px;*/
    /* height: 50px; */
    background: #035c83 !important;
    border: none;
}

.start-button:focus, .check-button:focus{
	border: none !important;
	box-shadow: none !important;
}

.timer-block{
	text-align: center;
    font-size: 2em;
}

.series, .result-series, .right-series{
    display: flex;
    margin: 0.2em;
    font-size: 2.5em;
    /* border: 1px solid #c7c7c9; */
    border-radius: 3px;
}
	
.num, .result-num, .right-num{
	display: flex;
    display: flex;
    color: black;
    /* background: #dcdbdb; */
    margin: 0.1em;
    padding: 2.0px;
    border: 1px solid #046b99;
    border-radius: 2px;
    justify-content: center;
    width: calc(10% - 0.4em);
    align-items: center;
    word-break: initial;
  	-webkit-touch-callout: none; /* iOS Safari */
	-webkit-user-select: none; /* Safari */
 	-khtml-user-select: none; /* Konqueror HTML */
    -moz-user-select: none; /* Firefox */
    -ms-user-select: none; /* Internet Explorer/Edge */
    user-select: none; /* Non-prefixed version, currently
                              supported by Chrome and Opera */
}

.result-num.correct-num{
	/*background: #0ed30e;*/
	border: 3px solid #009b01;
}

.result-num.incorrect-num{
	/*background: #ff7070;*/
	border: 3px solid #cb0711;
}
	    

.student-input-num{
	    background: #7fc0de !important;
	/*border-bottom: 4px solid #046b99;*/
}

.right-block{
	display: none;
}

input.num-input{
	text-align: center;
	width: 100%;
	font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
}

input.num-input[type='number'] {
    -moz-appearance:textfield;
}

input.num-input::-webkit-outer-spin-button,
input.num-input::-webkit-inner-spin-button {
    -webkit-appearance: none;
}


.highlight-num {
    background: #6ee1ff;
}


@media screen and (max-width: 992px) {
	.series, .result-series, .right-series{
		font-size: 1.5em;
	}
	.num, .result-num, .right-num{
		 width: calc(10% - 0.5em);
	}
	.timer-block{
	    font-size: 1.7em;
	}
	.start-button, .check-button{
		font-size: 1.5em;
	}
}

@media screen and (max-width: 600px) {
	.series, .result-series, .right-series{
		font-size: 1em;
	}
	.num, .result-num, .right-num{
		 width: calc(10% - 0.6em);
	}
	.timer-block{
	    font-size: 1.2em;
	}
	.start-button, .check-button{
		font-size: 1em;
	}
}

</style>

<script type="text/javascript">

var language = "ru";


var translations = new Object();
translations = {
    "en": {
        "start_btn_label": "Start",
        "check_btn_label": "Check",
        "show_correct_btn_label": "Show correct answer",
        "restart_btn_label": "Start over",
        "correct_answers_label": "You have correct answers",
        "correct_label": "Correct answer is",
         "instruction_label": "How to use:",
        "task_text_label": "<p>Click «Start» button to begin practice. You will see 7 numerical sequences. You have to figure out the logic in sequence and write down the missing number of the sequence. You will have 5 minutes to complete the job.</p><p>This method helps to assess reasoning (logical thinking).</p>",
        "comment_0_2_label": "You have to develop logical thinking. Do exercises and remember that regularity of the training is the key to success.",
        "comment_3_5_label": "You have a standard result for an adult. But don’t be complacent – continue developing your logical abilities.",
        "comment_5_plus_label": "Congrats! Your have shown almost top result. Continue to improve your logical thinking.",
        "test_results_label": "Test results",
    },
	"ru": {
		"start_btn_label": "Начать",
		"check_btn_label": "Проверить",
		"show_correct_btn_label": "Показать правильный ответ",
		"restart_btn_label": "Начать заново",
		"correct_answers_label": "Правильных ответов",
		"correct_label": "Правильный ответ",
        "instruction_label": "Инструкция",
		"task_text_label": "<p>Для начала прохождения тренажера нажмите кнопку «Начать». Вам будут предъявлены 7 числовых рядов. Необходимо найти закономерность построения каждого ряда и вписать недостающие числа. Время выполнения работы – 5 мин.</p><p>Методика оценивает логический аспект мышления.</p>",
		"comment_0_2_label": "Вам необходимо уделить внимание развитию логического мышления. Выполняйте упражнения и помните, что главное - это регулярность занятий.",
		"comment_3_5_label": "Результат в пределах нормы для взрослого человека. Но не расслабляйтесь и продолжайте уделять внимание развитию логического мышления.",
		"comment_5_plus_label": "Поздравляем! Ваши результаты близки к максимуму. Продолжайте совершенствовать свое показатели логического мышления.",
		"test_results_label": "Результаты теста",
	},
}

var user_labels = translations[language];



var series = {
	"series_1": {
		"answer": [12, 9],
		"task":[24, 21, 19, 18, 15, 13, "input", "input", 7]
	},
	"series_2": {
		"answer": [25, 36],
		"task":[1, 4, 9, 16, "input", "input", 49, 64, 81, 100]
	},
	"series_3": {
		"answer": [13, 20 ],
		"task":[16, 17, 15, 18, 14, 19, "input", "input"]
	},
	"series_4": {
		"answer": [36, 38],
		"task":[1, 3, 6, 8, 16, 18, "input", "input", 76, 78]
	},
	"series_5": {
		"answer": [13],
		"task":[7, 16, 9, 5, 21, 16, 9, "input", 4]
	},
	"series_6": {
		"answer": [44, 46],
		"task":[2, 4, 5, 10, 20, 22, "input", "input", 92, 94]
	},
	"series_7": {
		"answer": [10, 4],
		"task":[24, 22, 19, 15, "input", "input"]
	}
}

function arraysEqual(a, b) {
  var result = {}
  result["map"] = []
  for (var i = 0; i < a.length; ++i) {
    if (a[i] !== b[i]) {
      result["map"].push(false);
    }
    else {
      result["map"].push(true);
    }
  }
  result["correctness"] = result["map"].indexOf(false) == -1
  return result;
}


function validate_input(evt) {
  var theEvent = evt || window.event;
  if (theEvent.type === 'paste') {
      key = event.clipboardData.getData('text/plain');
  } else {
      var key = theEvent.keyCode || theEvent.which;
      key = String.fromCharCode(key);
  }
  var regex = /^-?\d*$/;
  if( !regex.test(key) ) {
    theEvent.returnValue = false;
    if(theEvent.preventDefault) theEvent.preventDefault();
  }
}

/**
 * https://gist.github.com/wcoder/fcee724b4f5b44062754
 * @param seconds - кол-во секунд
 * @param tick - функция, вызываемая каждую секунду
 * @param result - функция, вызываемая по истечении времени
 */
function timer (seconds, tick, result) {
	if (seconds != -1) {
		tick(seconds);
		seconds -= 1;
		setTimeout(function () {
			timer(seconds, tick, result);
		}, 1000);
	} else {
		result();
	}
}
function sec2time(timeInSeconds) {
  var pad = function (num, size) {
      return ('000' + num).slice(size * -1);
    },
    time = parseFloat(timeInSeconds).toFixed(3),
    hours = Math.floor(time / 60 / 60),
    minutes = Math.floor(time / 60) % 60,
    seconds = Math.floor(time - minutes * 60),
    milliseconds = time.slice(-3);

  return pad(minutes, 2) + ':' + pad(seconds, 2)
  // return pad(hours, 2) + ':' + pad(minutes, 2) + ':' + pad(seconds, 2) + ',' + pad(milliseconds, 3);
}

function NumericalSeries(element, time) {
	var start_block = createStartBlock();
	var time = time;
	var task_wrap;

	var restart_button = $("<button/>", {
		html: user_labels.restart_btn_label
	});

	restart_button.click(function (e) {
  			NumericalSeries(element, time);
  	});

	function createStartBlock() {
  		var start_wrap = $('<div></div>',{
  			class: "start-wrap",
  		});
		var start_button = $('<button></button>',{
  			class: "start-button",
  			text: user_labels.start_btn_label,
  		});
  		start_button.click(function (e) {
  			createTaskBlock();
  		});
		$(start_wrap).append(start_button)
  		$(element).html(start_wrap);
  	}

  	function createTaskBlock(){
  		task_wrap = $('<div></div>',{
  			class: "task-wrap",
  		});

  		Object.keys(series).forEach(function (key) {
  			var series_block = $('<div></div>',{
  				class: "series",
  				id: key,
  			});
  			series[key]["task"].forEach(function (item, i, arr) {
  				// console.log(item)
  				if (Number.isInteger(item)){
	  				var num = $('<div></div>',{
	  					class: "num",
	  					html: item.toString()
	  				});
	  				series_block.append(num)
	  			}
	  			else{
	  				if (item == "input"){
		  				var num_input = $('<div></div>',{
		  					class: "num student-input-num",
		  				});
		  				var input = $('<input/>',{
		  					type:"number", 
		  					class:"num-input", 
		  					min:"0",
		  					max:"99",
		  					maxlength: "2",
		  					onkeypress: 'validate_input(event)',
		  				}).appendTo($(num_input));

		  				input.on('input',function(e){
						  console.log($(this).val());
						});
		  				series_block.append(num_input)
	  				}
	  				else {
	  					var num = $('<div></div>',{
	  						class: "num",
	  						html: item.toString()
	  					});
	  				series_block.append(num)
	  				}
	  			}
			
			});
			task_wrap.append(series_block);
  		});
  		var timer_display = $('<div></div>',{
	  		class: "timer-block",
	  	});
	  	timer(time, function (s) {
			$(timer_display).html(sec2time(s));
		}, function () {
			createResultBlock()
		});
		$(task_wrap).prepend(timer_display);

		var check_button_wrap = $("<div/>", {
			class: "check-button-wrap"
		})
  	
		var check_button = $('<button></button>',{
  			class: "check-button",
  			text: user_labels.check_btn_label,
  		}).appendTo(check_button_wrap);

  		check_button.click(function (e) {
  			createResultBlock();
  		})

		$(task_wrap).append(check_button_wrap);

  		$(element).html(task_wrap);
	}

	function createResultBlock(){
		var grade = 0;
		var student_answers = {};
		console.log("student_answers: ", student_answers);
		Object.keys(series).forEach(function (key) {
			student_answers[key] = [];
			$("#" + key + " .student-input-num .num-input", task_wrap).each(function( index ) {
					student_answers[key].push( Number.isInteger(parseInt($(this).val())) ? parseInt($(this).val()) : "" );
			});
		});

		var result_wrap = $('<div></div>',{
  			class: "result-wrap",
  		});

		var right_block = $('<div></div>',{
  			class: "right-block",
  			html: "<h2>" + user_labels.correct_label + "</h2>"
  		});

		var show_correct_answer_button = $("<button/>", {
			html: user_labels.show_correct_btn_label
		});
		show_correct_answer_button.click(function() {
			right_block.slideToggle(500);
		});

  		result_wrap.append("<h2>" + user_labels.test_results_label + "</h2>");

		Object.keys(series).forEach(function (key) {
		    var result_series_block = $('<div></div>',{
  				class: "result-series",
  				id: "result_" + key,
  			});
  			var right_series_block = $('<div></div>',{
  				class: "right-series",
  				id: "right_" + key,
  			});
  			var check_res = arraysEqual(series[key]["answer"], student_answers[key]);
  			grade += check_res["correctness"] ? 1 : 0;
			var temp_i = 0;
	      	series[key]["task"].forEach(function (item, i, arr) {
				if (Number.isInteger(item)){
	  				var result_num = $('<div></div>',{
	  					class: "result-num",
	  					html: item.toString()
	  				});
	  				result_series_block.append(result_num);

	  				var right_num = $('<div></div>',{
	  					class: "right-num",
	  					html: item.toString()
	  				});
	  				right_series_block.append(right_num);

				}
				else{
					if (item == "input"){
						var result_num = $('<div></div>', {
		  					class: "result-num",
	  					});
						if (student_answers[key][temp_i] !== ""){
							result_num.html(student_answers[key][temp_i].toString())
						}
						if (check_res["map"][temp_i]){
							result_num.addClass("correct-num");
						}
						else{
							result_num.addClass("incorrect-num");
						}
		  				result_series_block.append(result_num);



		  				var right_num = $('<div></div>',{
		  					class: "right-num highlight-num",
		  					html: series[key].answer[temp_i].toString()
		  				});
		  				right_series_block.append(right_num);
		  				// result_series_block.append(result_num);


		  				temp_i += 1;
					}
					else {
						var result_num = $('<div></div>',{
							class: "result-num",
							html: item.toString()
						});
						result_series_block.append(result_num);
					}
				}
			});
			result_wrap.append(result_series_block);
			right_block.append(right_series_block);
		});


		var result_comment = $("<div/>", {
			class: "result-comment",
		});
		result_comment.append("<p style='font-weight:bold;'>" + user_labels.correct_answers_label +": " + grade.toString() + "</p>");
		if (grade <= 2){
			result_comment.append("<p>" + user_labels.comment_0_2_label + "</p>");
		}
		else if (grade >= 3 && grade <= 5){
			result_comment.append("<p>" + user_labels.comment_3_5_label + "</p>");
		}
		else if (grade > 5 ){
			result_comment.append("<p>" + user_labels.comment_5_plus_label + "</p>");
		}
		else {

		}

		result_wrap.append(result_comment);
		
		
		result_wrap.append($("<p>", {html: restart_button }));

		result_wrap.append($("<p>", {html: show_correct_answer_button }));

		result_wrap.append(right_block);

		$(element).html(result_wrap);
	}

}

var delay_time= 5 * 60;
display = document.querySelector('#numerical_series_task');
$("#task_text").html("<h2><strong>"+user_labels.instruction_label + "</strong></h2>" + user_labels.task_text_label);
NumericalSeries(display, delay_time);

</script>

<div id="task_text"></div>
<div id="numerical_series_task">
</div>


<!-- 

- высыпать таблику правильную

Inclus_M2 тема 3.5.

Методика «Закономерности числового ряда»

-->
