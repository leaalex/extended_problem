<style type="text/css">

    .task-let {
        display: inline-block;
        font-size: 1.4em;
        background: azure;
        letter-spacing: 0.2em;
        /* border: 1px solid; */
        /* margin: 2px; */
        /* border-bottom: 2px solid; */
        cursor: pointer;
        -moz-user-select: none;
        -khtml-user-select: none;
        user-select: none;
    }

    .word-candidate{
        background: #f0fbff;
        /*border-bottom: 2px solid;*/
        text-decoration: underline;
    }

    .task-let.word-hovered {
        background: #7fc0de;
    }


    .word-finded {
        /*visibility: hidden;*/
        text-decoration:line-through;
        /*text-decoration: underline;*/
    }



</style>

<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>

<script type="text/javascript">
    function range(start, end) {
        if (start > end) {
            end = [start, start = end][0];
        }
        return Array(end - start + 1).fill().map((_, idx) => start + idx)
    }

    $(document).ready(function () {

        var src_strings = ["бсолнцевтргщоцрайонзгучновостьхэьгчяфактуекэкзаментроч", "ягшгцкпрокуроргурстабюетеорияентсджэбьамхоккейтрсицы", "фцуйгзхтелевизорсолджщзхюэлгщьбапамятьшогхеюжпждргщ", "хэнздвосприятиейцукенгшщзхъвафыапролдблюбовьавфырпл", "ослдспектакльячсмитьбюжюерадостьвуфцпэждлорпкнародш", "лджьхэшщгиенакуыфйшрепортажэждорлафывюефбьконкурс", "йфячыцувскапрличностьзхжэьеюдшщглоджэпрплаваниедтлж", "эзбьтрдщшжнпркывкомедияшлдкцуйфотчаяниейфоячвтлджэ", "хьфтасенлабораториягщдщнруцтргшщтлроснованиезщдэркэ", "нтаопрукгвсмтрпсихиатриябплмстчьйсмтзацэъагнтэхт"];

        var correct_strings = ["солнце", "район", "новость", "факт", "экзамен", "прокурор", "теория", "хоккей", "телевизор", "память", "восприятие", "любовь", "спектакль", "радость", "народ", "гиена", "репортаж", "конкурс", "личность", "плавание", "комедия", "отчаяние", "лаборатория", "основание", "психиатрия"];

        var num = 0;
        var first_selected;
        var hovered_array = [];
        var finded_words = [];
        var selected_words = [];

        var letters_task = $("<div>", {
            id: "letters_task"
        });

        var task_progress = $("<div>", {
            id: "task_progress",
            style: "font-weight: bold",
            html: "<p>Найдено слов: " + finded_words.length + "</p>"
        });



        src_strings.forEach(function (src_string, idx) {
            var line = $("<div>", {
                class: "line-wrap"
            });

            for (var i = 0; i < src_string.length; i++) {
                var letter_div = $("<div>", {
                    html: src_string.charAt(i),
                    class: "task-let",
                    "data-num": num.toString(),
                    "data-char": src_string.charAt(i),
                    id: "let_num_" + num.toString()
                });
                console.log(num);
                line.append(letter_div);
                num += 1;
                letter_div.click(function (event) {
                    if ($(event.target).hasClass("word-finded")) return false;

                    if (first_selected){
                        first_selected = undefined;
                        var word = "";
                        $(".word-candidate").each(function(index, element){
                            word += element.dataset.char;
                            console.log(element);
                        });

                        if (correct_strings.includes(word)){
                            console.log();
                            finded_words.push(word);
                            task_progress.html("<p>Найдено слов: " + finded_words.length + "</p>");
                            hovered_array.forEach(function(num){
                                $("#let_num_" + num.toString()).addClass("word-finded");
                            });

                        }
                        else{
                            $(".task-let").removeClass("word-candidate");
                            alert('Слово "' + word + '" не найдено!');
                        }
                        console.log(word);


                    }
                    else{
                        first_selected = event.target.dataset.num
                    }
                    console.log(first_selected);

                });

                letter_div.mouseover(function (event) {
                    if ($(event.target).hasClass("word-finded")) return false;
                    $(".task-let").removeClass("word-candidate");

                    if (first_selected) {
                        // console.log()
                        console.log();
                        hovered_array = range(parseInt(first_selected), parseInt(event.target.dataset.num));

                        hovered_array.forEach(function(num){
                            $("#let_num_" + num.toString()).addClass("word-candidate");
                        })
                    }
                    else{
                        $(event.target).addClass("word-hovered");
                    }
                });

                letter_div.mouseleave(function (event) {
                    $(event.target).removeClass("word-hovered");
                });


            }
            letters_task.append(line);

        });




        // sybmol_breaks.forEach(function (last_num, idx) {
        //
        //     var first_num = idx == 0 ? 0 : sybmol_breaks[idx - 1];
        //     var current_str = src_string.slice(first_num, last_num);
        //     // console.log(current_str);
        //
        //     var line = $("<div>", {
        //         class: "line-wrap"
        //     });
        //
        //     for (var i = 0; i < current_str.length; i++) {
        //         var letter_div = $("<div>", {
        //             html: current_str.charAt(i),
        //             class: "task-let",
        //             num: (first_num + i).toString(),
        //             id: "let_num_" + (first_num + i).toString()
        //         });
        //         // console.log();
        //         line.append(letter_div);
        //
        //
        //     }
        //
        //     letters_task.append(line);
        //
        // });

        $("#munsterberg_test").append(letters_task);
        $("#munsterberg_test").append(task_progress);

    });
</script>


<div id="munsterberg_test">

</div>
