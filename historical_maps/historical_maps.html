<problem>
<script type="loncapa/python">
import json

cities = [
    {
        "id": "city_0",
        "title": "Москва",
    },
    {
        "id": "city_10",
        "title": "Соликамск",
        "year": 1430,
    },
    {
        "id": "city_13",
        "title": "Тобольск",
        "year": 1587,
    },
    {
        "id": "city_12",
        "title": "Берёзово",
        "year": 1593,
    },
    {
        "id": "city_16",
        "title": "Сургут",
        "year": 1594,
    },
    {
        "id": "city_14",
        "title": "Обдорск (Салехард)",
        "year": 1595,
    },
    {
        "id": "city_19",
        "title": "Томск",
        "year": 1604,
    },
    {
        "id": "city_20",
        "title": "Красноярск",
        "year": 1628,
    },
    {
        "id": "city_21",
        "title": "Братск",
        "year": 1631,
    },
    {
        "id": "city_24",
        "title": "Якутск",
        "year": 1632,
    },
    {
        "id": "city_23",
        "title": "Чита",
        "year": 1653,
    },
    {
        "id": "city_32",
        "title": "Петропавловск-Камчатский",
        "year": 1740,
    },
    {
        "id": "city_28",
        "title": "Хабаровск",
        "year": 1858,
    },
    {
        "id": "city_30",
        "title": "Владивосток",
        "year": 1860,
    },
    {
        "id": "city_29",
        "title": "Анадырь",
        "year": 1889,
    }
]

correct_list = []

for index, x in enumerate(cities):
    if len(cities) > (index + 1):
        correct_list.append({"from": x["id"], "to": cities[index + 1]["id"]})

# print(correct_list)


def check_answer(exp, ans):
    student_answer = json.loads(ans)["answer"]
    max_grade = len(cities) - 1
    student_correct = {}

    for c_a in correct_list:
        s_a_id = next((l for l in student_answer.keys() if student_answer[l]['from'] == c_a["from"] and student_answer[l]['to'] == c_a["to"]), None)
        if s_a_id is not None:
            student_correct[s_a_id] = student_answer[s_a_id]
            student_correct[s_a_id]["to_year"] = next((l for l in cities if l['id'] == c_a["to"]), None)["year"]
            student_correct[s_a_id]["to_title"] = next((l for l in cities if l['id'] == c_a["to"]), None)["title"]
        else:
            break

    grade = len(student_correct.keys())
    result_grade = grade / max_grade
    msg = json.dumps(student_correct)
    if result_grade == 1:
        return {'input_list': [{'ok': True, 'msg': msg, 'grade_decimal': 1}]}
    elif result_grade == 0:
        return {'input_list': [{'ok': False, 'msg': msg, 'grade_decimal': 0}]}
    else:
        return {'input_list': [{'ok': 'Partial', 'msg': msg, 'grade_decimal': result_grade}]}

</script>
<!--    <link rel="stylesheet" href="./historical_maps.css"></link>-->
<!--    <script type="text/javascript" src="./historical_maps_source.js"></script>-->
<!--    <script type="text/javascript" src="./historical_maps.js"></script>-->

    <link rel="stylesheet" href="/static/historical_maps.css"></link>
    <script type="text/javascript" src="/static/historical_maps_source.js"></script>
    <script type="text/javascript" src="/static/historical_maps.js"></script>

    <div class="task-description">
<!--        <h2>Инструкция</h2>-->
        <p>1. Написать студентам норм инструкцию, описать задание</p>
        <p>2. Т к карта мелкая можно написать, что можно увеличивать масштаб в браузере Ctrl + колесико вверх вниз</p>
        <p>3. Правильный ответ показать по кнопке "Показать ответ". Но в какой момент она появляется? Когда попытки исчерпаны? или всегда есть?</p>
        <p>4. А ограничены ли вообще попытки?</p>
        <p></p>

        <p><b>Инструкция по использованию, тоже надо будет норм описать:</b></p>
        <p>1. Если кружочек закрашен зеленым из него можно тянуть стрелку</p>
        <p>2. Для удаления стрелки кликнуть по ней, удаляются все стрелки после нее</p>
        <p>3. Для отмены стрелки, которую тянем сейчас кликнуть по пустому пространству на карте или клавиша эскейп</p>
        <p>4. Верные стрелки удалить нельзя</p>
        <p>5. Верные стрелки после проверки зелёные становятся</p>
        <p>6. Количество стрелок ограничено, чтобы студент закончил в нужном месте (стрелок доступно столько же, сколько городов в правильном маршруте)</p>
        <p>7. Стрелку можно поставить в город с мигающей зеленой обводкой</p>

        <p></p>
        <p>Даты основания городов:</p>

        <div>Соликамск – 1430</div>
        <div>Тобольск – 1587</div>
        <div>Берёзов – 1593</div>
        <div>Сургут – 1594</div>
        <div>Обдорск (Салехард) – 1595</div>
        <div>Томск – 1604</div>
        <div>Красноярск – 1628</div>
        <div>Братск – 1631</div>
        <div>Якутск – 1632</div>
        <div>Чита – 1653</div>
        <div>Петропавловск-Камчатский – 1740</div>
        <div>Хабаровск – 1858</div>
        <div>Владивосток – 1860</div>
        <div>Анадырь – 1889</div>
    </div>

    <div class="historical-map-container">
    </div>

<!--    <div id="test_input"><input type="text" value='-->
<!--'/>-->
<!--    </div>-->

    <div id="historical_map_input" style="/*display: none!important;*/">
        <customresponse cfn="check_answer">
            <textline size="40" value="$taskId"/>
            <br/>
        </customresponse>
    </div>

    <script type="text/javascript">

        let src_map = new sourceMap().svg_map;

        new HistoricalMaps({
            svg: src_map,
            element: document.querySelector(".historical-map-container"),
            input: document.querySelector("#historical_map_input"),
            main_city_selector: "#main_city",
            cities_selector: "#cities",
            max_arrows: 20,
        });

        $( document ).ready(function() {
            setTimeout(function(){console.log($(".submit.btn-brand"), $(".submit.btn-brand").prop("disabled")); $(".submit.btn-brand").removeAttr("disabled")}, 5000);
            // console.log(  );
        });

    </script>

    <solution>
        <h2>Правильный ответ</h2>
    <img src="/static/historical_maps_correct_img.svg" ></img>
    </solution>
</problem>
