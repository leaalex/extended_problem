<style type="text/css">

.task-wrap, .start-wrap, .table-wrap {
      height: 680px;
    /* background: #f6f6f6; */
    display: flex;
    justify-content: center;
    align-items: center;
    flex-direction: column;   
}

.result-wrap{
    margin-bottom: 20px;
    display: flex;
    justify-content: start;
    align-items: center;
    flex-direction: column; 
}

.start-wrap{
	border: 6px double #046b99;
}

.start-button{
    font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
    width: 200px;
    /*height: 50px; */
    background: #046b99;
    color: #ffffff;
    font-size: 1.8em;
    font-weight: normal;
    border: none;
}
.start-button:hover{
    /*font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
    width: 200px;*/
    /* height: 50px; */
    background: #035c83 !important;
    border: none;
}
#twelve_numbers{
	    padding: 2px;
}

.check-button{
    font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
    width: 200px;
     /*height: 50px; */
    background: #046b99;
    color: #ffffff;
    font-size: 1.8em;
    font-weight: normal;
    border: none;
}

.check-button:hover{
    background: #035c83 !important;
    border: none;
}



.timer-block{
	text-align: center;
    font-size: 2em;
}

.table-block{
 
}

.check-button-wrap{
	    text-align: center;
    margin: 16px 0px;
}

.user-num-input{
	height: auto !important;
	font-size: 3em;
	width: 100%;
}

#restart_task{
	display: none;
}

.task-text-block{
	text-align: center;
}



.num-table-wrap {
  display: flex;
  flex-wrap: wrap;
}


.num-table-item {
    /* cursor: pointer; */
    flex: 1 0 21%;
    margin: 5px;
    font-size: 3.5em;
    /* height: 100px; */
    background-color: #0000ff2b;
    display: flex;
    justify-content: center;
    align-items: center;
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    -khtml-user-select: none;
    -moz-user-select: none;
    -ms-user-select: none;
    user-select: none;
    background: white;
    margin: -2px;
    border: 4px solid #046b99;
}

.result-num-table-wrap {
  display: flex;
  flex-wrap: wrap;
}

.result-num-table-item {
    flex: 1 0 21%;
    display: flex;
    justify-content: center;
    align-items: center;
    background: white;
    margin: -2px;
    font-size: 2em;
    border: 4px solid #046b99;
}

.item-correct {
    background: #bcffbc;
}

</style>

<script type="text/javascript">

//двухбуквенный код
var language = "en";


var translations = new Object();
translations = {
	"en": {
		"start_btn_label": "Start",
		"check_btn_label": "Check",
		"restart_btn_label": "Restart",
		"test_results_label": "Test results",
		"numbers_exceeded_label": "Number of entered numbers exceeded",
    "task_text_label": "Запишите все числа, которые Вы запомнили. Числа могут быть записаны в любой последовательности, как только Вы закончите нажмите кнопку «Проверить».",
    "main_task_text_label": "<h2><strong>Инструкция:</strong></h2><p>Уважаемый студент, после нажатия кнопки «Начать» Вам будет предъявлена таблица с числами. Ваша задача заключается в том, чтобы за 20 секунд, запомнить как можно больше чисел. Когда таблица исчезнет, вам необходимо записать числа, которые вы запомнили, в открывшемся окне. Числа могут быть записаны в любой последовательности. Разделять числа следует любым удобным способом: через запятую, пробел или табуляцию. </p><p>Пожалуйста, не записывайте цифры, а только ЗАПОМИНАЙТЕ.</p><p>Тренажер предназначен для оценки кратковременной зрительной памяти, ее объема и точности.</p>",
    "result_label_main_1": "По результатам данного упражнения у Вас верно воспроизведенных чисел:",
    "result_label_main_2": "(они подсвечены зеленым цветом). Норма взрослого человека от пяти до девяти чисел.",
    "result_label_less_4": "Показатель кратковременной зрительной памяти у вас ниже нормы, что указывает на необходимость регулярных тренировок. Практикуйтесь в прохождении этого тренажера каждый день в течение недели и вы заметите улучшение показателей.",
    "result_label_5_8": "Показатель кратковременной зрительной памяти соответствует норме. Если вам для учебы или работы необходимо работать с большим объемом чисел, то практикуйтесь в прохождении этого тренажера несколько раз в неделю. ",
    "result_label_more_8": "Поздравляем, Вы гений! Подобные результаты показали лишь 8 % опрошенных. ",
    "result_label_restart": "Вы в любое время можете вернутся к данному тренажеру и потренировать свою зрительную кратковременную память, тем самым улучшить или закрепить Ваши результаты."
	},
	"ru": {
		"start_btn_label": "Начать",
		"check_btn_label": "Проверить",
		"restart_btn_label": "Начать заново",
		"test_results_label": "Результаты теста",
		"numbers_exceeded_label": "Превышено количество введенных чисел!",
		"task_text_label": "Запишите все числа, которые Вы запомнили. Числа могут быть записаны в любой последовательности, как только Вы закончите нажмите кнопку «Проверить».",
		"main_task_text_label": "<h2><strong>Инструкция:</strong></h2><p>Уважаемый студент, после нажатия кнопки «Начать» Вам будет предъявлена таблица с числами. Ваша задача заключается в том, чтобы за 20 секунд, запомнить как можно больше чисел. Когда таблица исчезнет, вам необходимо записать числа, которые вы запомнили, в открывшемся окне. Числа могут быть записаны в любой последовательности. Разделять числа следует любым удобным способом: через запятую, пробел или табуляцию. </p><p>Пожалуйста, не записывайте цифры, а только ЗАПОМИНАЙТЕ.</p><p>Тренажер предназначен для оценки кратковременной зрительной памяти, ее объема и точности.</p>",
    "result_label_main_1": "По результатам данного упражнения у Вас верно воспроизведенных чисел:",
    "result_label_main_2": "(они подсвечены зеленым цветом). Норма взрослого человека от пяти до девяти чисел.",
    "result_label_less_4": "Показатель кратковременной зрительной памяти у вас ниже нормы, что указывает на необходимость регулярных тренировок. Практикуйтесь в прохождении этого тренажера каждый день в течение недели и вы заметите улучшение показателей.",
    "result_label_5_8": "Показатель кратковременной зрительной памяти соответствует норме. Если вам для учебы или работы необходимо работать с большим объемом чисел, то практикуйтесь в прохождении этого тренажера несколько раз в неделю. ",
    "result_label_more_8": "Поздравляем, Вы гений! Подобные результаты показали лишь 8 % опрошенных. ",
    "result_label_restart": "Вы в любое время можете вернутся к данному тренажеру и потренировать свою зрительную кратковременную память, тем самым улучшить или закрепить Ваши результаты."
	},
}

var user_labels = translations[language];
  		  // var pad = function (num, size) {
		    //   return ('000' + num).slice(size * -1);
		    // },
		    // in_sec = parseFloat(time).toFixed(3),
		    // hours = Math.floor(in_sec / 60 / 60),
		    // minutes = Math.floor(in_sec / 60) % 60,
		    // seconds = Math.floor(in_sec - minutes * 60),
		    // milliseconds = in_sec.slice(-3);

/**
 * https://gist.github.com/wcoder/fcee724b4f5b44062754
 * @param seconds - кол-во секунд
 * @param tick - функция, вызываемая каждую секунду
 * @param result - функция, вызываемая по истечении времени
 */
function timer (seconds, tick, result) {
	if (seconds != -1) {
		tick(seconds);
		seconds -= 1;
		setTimeout(function () {
			timer(seconds, tick, result);
		}, 1000);
	} else {
		result();
	}
}
function sec2time(timeInSeconds) {
  var pad = function (num, size) {
      return ('000' + num).slice(size * -1);
    },
    time = parseFloat(timeInSeconds).toFixed(3),
    hours = Math.floor(time / 60 / 60),
    minutes = Math.floor(time / 60) % 60,
    seconds = Math.floor(time - minutes * 60),
    milliseconds = time.slice(-3);

  return pad(minutes, 2) + ':' + pad(seconds, 2)
  // return pad(hours, 2) + ':' + pad(minutes, 2) + ':' + pad(seconds, 2) + ',' + pad(milliseconds, 3);
}


function TwelveNumbers(element, time) {
  var random_numbers = get_random_numbers(10,99,12);
  var start_window = createStartBlock();

  $("#restart_task").html(user_labels.restart_btn_label)
  $("#restart_task").hide();

  function createStartBlock() {
  		var start_wrap = $('<div/>',{
  			class: "start-wrap",
  		});
		var start_button = $('<button/>',{
  			class: "start-button",
  			text: user_labels.start_btn_label,
  		});
  		start_button.click(function (e) {
  			createTableBlock();
  		})
		$(start_wrap).append(start_button)
  		$(element).html(start_wrap);
  }

  function createTableBlock(){

  	var task_wrap = $('<div/>',{
  		class: "table-wrap",
  	});
  	var num_table_wrap = $('<div/>',{
  			class: "num-table-wrap",
  		});
  	random_numbers.forEach(function (item, i, arr) {
  		var num_table_item = $('<div/>',{
  			class: "num-table-item",
  			text: item,
  		});
  		$(num_table_wrap).append(num_table_item);
  	})
	var timer_display = $('<div/>',{
  		class: "timer-block",
  	});
  	timer(time, function (s) {
		$(timer_display).html(sec2time(s));
	}, function () {
		createAnswerBlock()
	});
	$(task_wrap).append(timer_display);
  	$(task_wrap).append(num_table_wrap);
  	$(element).html(task_wrap);
  }

  function createAnswerBlock(){
  	  	var check_wrap = $('<div/>',{
  		class: "task-wrap",
  	});
  	var user_input_wrap = $('<div/>',{
  			class: "user-input-wrap",
  		});
  	
  	var task_text_block = $('<p/>', {
		class: "task-text-block",
		text: user_labels.task_text_label,
	}).appendTo(user_input_wrap);

  	var user_input = $('<textarea/>',{
  	  		type: "text",
  	  		rows: "2",
  			class: "user-num-input",
  	});
	
	var check_button_wrap = $('<div>',{
		class: "check-button-wrap"
	});

	var check_button = $('<button/>',{
  			class: "check-button",
  			text: user_labels.check_btn_label,
  	}).appendTo(check_button_wrap);

  	check_button.click(function (e) {
  		var answer = $(user_input).val();
  		createResultBlock(answer);
	})
  		$(user_input_wrap).append(task_text_block);
  	  	$(user_input_wrap).append(user_input);
  	  	$(user_input_wrap).append(check_button_wrap);
  	  	$(check_wrap).append(user_input_wrap)
  	  	$(element).html(check_wrap);
  }

  function createResultBlock(answer){

  	    var answer_arr = answer.split(/[ ,\t\n]+/).filter(function (item) { return !isNaN(parseFloat(item))}).map(function(item){return parseInt(item)});
  	    if (answer_arr.length > 15){
  	    	alert(user_labels.numbers_exceeded_label);
  	    	return;
  	    }
  	    var grade = 0;
  	    var result_wrap = $('<div/>',{
  			class: "result-wrap",
  		});

  	    var result_block_wrap = $('<div/>',{
  			class: "result-block-wrap",
  		});

  	    var result_num_table_wrap = $('<div/>',{
  			class: "result-num-table-wrap",
  		});
	  	random_numbers.forEach(function (item, i, arr) {
	  		var result_num_table_item = $('<div/>',{
	  			class: "result-num-table-item",
	  			text: item,
	  			id: "result_number_" + item,
	  			"data-number": item,
	  		});
	  		if (answer_arr.includes(item)){
	  			grade += 1;
	  			result_num_table_item.addClass("item-correct");
	  		}
	  		$(result_num_table_wrap).append(result_num_table_item);
	  	});

	  	result_wrap.append("<div><h2>" +  user_labels.test_results_label + "</h2>" + "<p>" + user_labels.result_label_main_1 + " <strong>" + grade + "</strong> " + user_labels.result_label_main_2 + "</p></div>");
       
       if (grade <= 4){
          result_wrap.append("<div style='width: 100%;'><p>" + user_labels.result_label_less_4 + "</p></div>");
       }
       else if (8 < grade){
          result_wrap.append("<div style='width: 100%;'><p>" + user_labels.result_label_more_8 + "</p></div>");
       }
       else {
          result_wrap.append("<div style='width: 100%;'><p>" + user_labels.result_label_5_8 + "</p></div>");
       }


       result_wrap.append("<div><p>" + user_labels.result_label_restart + "</p></div>")
	  	$(result_block_wrap).append(result_num_table_wrap);
	  	$(result_wrap).append(result_block_wrap)
  	    $(element).html(result_wrap);
  		$("#restart_task").show();
  }

  function get_random_numbers(start,end,count) {
	    return  Array(end - start + 1).fill().map((_, idx) => start + idx).sort(function (){ return .5 - Math.random()}).slice(0, count);
  }
}

$("#task_text").html(user_labels.main_task_text_label);

var delay_time= 20;
display = document.querySelector('#twelve_numbers');
TwelveNumbers(display, delay_time);

$("#restart_task").click(function (e) {
  	TwelveNumbers(display, delay_time);
});

</script>

<div id="task_text"></div>
<div id="twelve_numbers"></div>
<button id="restart_task">Restart</button>

<!--

Inclus_M2 тема 3.2

  -->