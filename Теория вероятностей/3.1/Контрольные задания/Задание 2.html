<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <script type="text/javascript" async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-MML-AM_CHTML">
</script>
</head>
<body>
<div id="graphic_item">
</div>

</body>
<script type="text/javascript">
function createElementSVG(name, id, classList, attributes) {
        var NS = "http://www.w3.org/2000/svg";
        var element = document.createElementNS(NS, name);
        if (id) element.id = id;

        if (classList) element.classList.add(classList);
        if (attributes) {
            for (attribute in attributes) {
                element.setAttribute(attribute, attributes[attribute])
            }
        }
        return element;
    };
function createTextSVG(x, y, text, attributes) {
    var NS = "http://www.w3.org/2000/svg";
    var textObject = document.createElementNS(NS, "text");
    var textObject = createElementSVG("text", null, null, {
        x: x,
        y: y
    });
    if (attributes) {
        for (attribute in attributes) {
            textObject.setAttribute(attribute, attributes[attribute])
        }
    }
    var textNode = document.createTextNode(text);
    textObject.appendChild(textNode);
    return textObject;
}
function setAttributes(element, attrs) {
        for (var key in attrs) {
            element.setAttribute(key, attrs[key]);
        }
        return element;
    };

let data = [
    {x: 3, y:0.37},
    {x: 6, y:0.12},
    {x: 9, y:0.21},
    {x: 12, y:0.25},
    {x: 15, y:0.05},
]

data = [
    {x: 5, y:16},
    {x: 10, y:38},
    {x: 15, y:29},
    {x: 20, y:12},
    {x: 25, y:5},
]

// data = [
//     {x:2,y:22},
//     {x:4,y:13},
//     {x:6,y:38},
//     {x:8,y:30},
//     {x:10,y:7}
// ]

let chart_type = "bar" // line || bar
chart_type = "line" // line || bar

let SVG_height = 480;
let SVG_width = 480;
let background_color = "#fbfbfb";
let background_stroke = "#e4e4e4";
let background_stroke_width = 3;

let margins = 40;
let arrow_margin = 60; // отступ от края графика

let font_size = 18;
let axis_near_zero = 30;
let num_width = font_size * 0.642; // 9
let num_height = font_size * 0.714; // 10

let hide_indexes = {
    x: {},
    y: {4:{replace_with: ""}},
    // y: {0:{replace_with: ""},},
}

let axis_labels = {
    x: {
        text: "\\(x_i\\)",
        size: 20,
    },
    y: {
        text: "\\(n_i\\)",
        size: 20,
    }
}

let axis_style = {
    color: "black",
    size: 2.3,
}

let line_style = {
    color: "black",
    size: 2.2,
}

let point_style = {
    color: "black",
    size: 4,
}

let projection_style = {
    color: "black",
    size: 1,
    dasharray: "6 3",
}


let svg = createElementSVG('svg', "time_line_svg", null, {
    "viewbox": '0 0 ' + SVG_width + ' ' + SVG_height,
    "width": SVG_width,
    "height": SVG_height,
});

let background = createElementSVG('rect', null, 'time-line-background', {
    "x": "0",
    "y": "0",
    "width": SVG_width,
    "height": SVG_height,
    "fill": background_color,
    "stroke": background_stroke,
    'stroke-width': background_stroke_width,
});

let axis_arrow = createElementSVG('marker', 'x-axis-marker' , null, {
    "markerWidth": "10",
    "markerHeight": "10",
    "refX": "0.5",
    "refY": "3",
    "orient": "auto",
    "markerUnits": "strokeWidth"
});
axis_arrow.innerHTML = '<path d="M-3,0 L-3,6 L6,3 z" fill="' + (axis_style.color || "black") + '" />';
svg.append(axis_arrow);

let y_axis = createElementSVG('line', null, 'items-zone-line', {
    "x1": margins,
    "y1": SVG_height - margins + axis_near_zero,
    "x2": margins,
    "y2": margins,
    "stroke": axis_style.color || "black",
    "stroke-width": axis_style.size || 2,
    "marker-end": "url(#x-axis-marker)",

});
let x_axis = createElementSVG('line', null, 'items-zone-line', {
    "x1": margins - axis_near_zero,
    "y1": SVG_height - margins,
    "x2": SVG_width - margins,
    "y2": SVG_height - margins,
    "stroke": axis_style.color || "black",
    "stroke-width": axis_style.size || 2,
    "marker-end": "url(#x-axis-marker)",
});

let x_axis_label = createElementSVG('foreignObject', null, '', {
    "x": SVG_width - margins,
    "y": SVG_height - margins,
    "width": "100%",
    "height":(font_size * 2) + "px",
});
x_axis_label.innerHTML = '<div style="font-size:' + font_size + 'px">' + axis_labels.x.text + '</div>'

let y_axis_label = createElementSVG('foreignObject', null, '', {
    "x": margins - axis_labels.y.size - 6,
    "y": margins,
    "width": "100%",
    "height":(font_size * 2) + "px",
});
y_axis_label.innerHTML = '<div style="font-size:' + font_size + 'px">' + axis_labels.y.text + '</div>'

let zero_label = createTextSVG(margins - num_width-4, SVG_height - margins + num_height + 4, "0", {"font-size": font_size + "px",})

svg.append(background);
svg.append(zero_label)
svg.append(x_axis);
svg.append(y_axis);
svg.append(x_axis_label)
svg.append(y_axis_label)

let graphic_group = createElementSVG('g', "graphic_group", null, {});

let defs =  createElementSVG('defs', "", null, {});
defs.innerHTML = `<pattern id="pattern_yPourJ" patternUnits="userSpaceOnUse" width="7" height="7" patternTransform="rotate(45)"><line x1="0" y="0" x2="0" y2="7" stroke="#868686" stroke-width="2" /></pattern>`

svg.append(defs)

if (chart_type === "line"){
    let prev_point = {}
    data.forEach(function (point, index, points_arr){
        let free_space_x = SVG_width - (2*margins) - arrow_margin;
        let free_space_y = SVG_height - (2*margins) - arrow_margin;

        let point_x = (margins) + (free_space_x/Math.max(...points_arr.map(function(p){return p.x})) * point.x)
        let point_y = (SVG_height - margins) - (free_space_y/Math.max(...points_arr.map(function(p){return p.y})) * point.y);

        let to_x_projection = createElementSVG('line', null, 'projection', {
            "x1": point_x,
            "y1": point_y,
            "x2": point_x,
            "y2": SVG_height - margins,
            "stroke": projection_style.color || "black",
            "stroke-dasharray": projection_style.dasharray || 3,
            "stroke-width": projection_style.size || 1.3,
        });

        let to_y_projection = createElementSVG('line', null, 'projection', {
            "x1": point_x,
            "y1": point_y,
            "x2": margins,
            "y2": point_y,
            "stroke": projection_style.color || "black",
            "stroke-dasharray": projection_style.dasharray || 3,
            "stroke-width": projection_style.size || 1.3,
        });

        if (index !== points_arr.length && index !== 0){
            let line1 = createElementSVG('line', null, 'graphic-line', {
                "x1": point_x,
                "y1": point_y,
                "x2": prev_point.x,
                "y2": prev_point.y,
                "stroke": line_style.color || "black",
                "stroke-width": line_style.size || 1.5,
            });
            graphic_group.append(line1)
        }

        let graphic_point = createElementSVG('circle', null, 'items-zone-line', {
            "r": point_style.size,
            "cx": point_x,
            "cy": point_y,
            "fill": point_style.color || "black",
        });

        prev_point = {
            x: point_x,
            y: point_y
        }

        graphic_group.append(to_x_projection);
        graphic_group.append(to_y_projection);
        graphic_group.append(graphic_point);

        let x_label_text =  point.x.toString();
        if (Object.keys(hide_indexes.x).includes(index.toString())) {
            x_label_text = hide_indexes.y[index].replace_with;
        }
        let label_x = createTextSVG(point_x -  ((x_label_text).toString().replace(".","").length * num_width/3), SVG_height - margins + num_height + 4, x_label_text, {"font-size": font_size + "px",});
        graphic_group.append(label_x);

        let y_label_text =  point.y.toString();
        if (Object.keys(hide_indexes.y).includes(index.toString())) {
            y_label_text = hide_indexes.y[index].replace_with;
        }
        let label_y = createTextSVG(margins - ((y_label_text).toString().replace(".", "").length * num_width) - 4, point_y + num_height / 2, y_label_text, {"font-size": font_size + "px",});
        graphic_group.append(label_y);
    });
}
else{
    let prev_point = {}
    data.forEach(function (point, index, points_arr){
        let free_space = SVG_width - (2*margins) - arrow_margin;
        let bar_step = (free_space/Math.max(...points_arr.map(function(p){return p.x})))
        let bar_y = SVG_height - margins - (free_space/Math.max(...points_arr.map(function(p){return p.y})) * point.y);

        let bar = createElementSVG('rect', null, 'time-line-background', {
            "x": margins + (index == 0 ? 0: bar_step * points_arr[index - 1].x ),
            "y": bar_y,
            "width": index == 0 ? bar_step * (point.x - 0) : bar_step * (point.x - points_arr[index - 1].x),
            "height": (free_space/Math.max(...points_arr.map(function(p){return p.y})) * point.y),
            "stroke": line_style.color || "black",
            "fill":"url(#pattern_yPourJ)",
            "stroke-width": line_style.size || 2,
        });
        let to_y_projection = createElementSVG('line', null, 'projection', {
            "x1": margins + (index == 0 ? 0: bar_step * points_arr[index - 1].x ),
            "y1": bar_y,
            "x2": margins,
            "y2": bar_y,
            "stroke": projection_style.color || "black",
            "stroke-dasharray": projection_style.dasharray || 3,
            "stroke-width": projection_style.size || 1.3,
        });
        let y_label_text =  point.y.toString();
        if (Object.keys(hide_indexes.y).includes(index.toString())) {
            y_label_text = hide_indexes.y[index].replace_with;
        }
        let label_y = createTextSVG(margins - ((y_label_text).toString().replace(".", "").length * num_width) - 4, bar_y + num_height / 2, y_label_text, {"font-size": font_size + "px",})
        graphic_group.append(label_y)

        let x_label_text =  point.x.toString();
        if (Object.keys(hide_indexes.x).includes(index.toString())) {
            x_label_text = hide_indexes.x[index].replace_with;
        }
        let label_x = createTextSVG(margins + (bar_step * point.x) - ((x_label_text).toString().replace(".", "").length * num_width)/2, SVG_height - margins + num_height + 4, x_label_text, {"font-size": font_size + "px",})
        graphic_group.append(label_x)

        graphic_group.append(to_y_projection);
        graphic_group.append(bar);

    });
}





svg.append(graphic_group);

document.querySelector("#graphic_item").append(svg)
</script>

</html>