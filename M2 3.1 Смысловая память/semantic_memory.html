<!--<script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.js"></script>-->
<!--<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"-->
<style>

    #semantic_memory_task {
        border: 6px double #046b99;
        padding: 10px;
    }

    #words_pair_wrap {
        /*font-size: 2em;*/
        font-size: 230%;
        /*background: #f6f6f6;*/
        color: black;
        padding: 20px;
        /*height: 50px;*/
        height: 8em;
        /*width: 500px;*/
        /*border: 2px solid #d7d7d7;*/
        display: flex;
        justify-content: center; /* align horizontal */
        align-items: center;
        -webkit-touch-callout: none; /* iOS Safari */
        -webkit-user-select: none; /* Safari */
        -khtml-user-select: none; /* Konqueror HTML */
        -moz-user-select: none; /* Firefox */
        -ms-user-select: none; /* Internet Explorer/Edge */
        user-select: none; /* Non-prefixed version, currently supported by Chrome and Opera */
    }

    #semantic_memory {
        max-width: 810px;
        margin: 0 auto;
    }

    /*.instruction-block{*/
    /*    background: #fafafa;*/
    /*    padding: 6px;*/
    /*    border-radius: 0.5em;*/
    /*}*/

    .start-button, .check-button {
        font-family: "Open Sans", Verdana, Geneva, sans-serif, sans-serif;
        /*width: 6em;*/
        text-shadow: none !important;
        background: #046b99;
        color: #ffffff;
        font-size: 1.5em;
        font-weight: normal;
        border: none;
    }

    .start-button:hover, .check-button:hover {
        /*font-family: "Open Sans",Verdana,Geneva,sans-serif,sans-serif;
        width: 200px;*/
        /* height: 50px; */
        background: #035c83 !important;
        border: none;
        cursor: pointer;
    }

    .start-button:focus, .check-button:focus {
        border: none !important;
        box-shadow: none !important;
    }

    .start-wrap {
        padding: 1.5em 0;
        text-align: center;
    }

    .input-pair-wrap {
        /*margin: 6px;*/
        padding: 6px;
        /*border-radius: 6px;*/
        /*background: #eefbff;*/
        /*display: flex;*/
        /*flex-wrap: wrap;*/
        /*justify-content: center;*/
        /*align-items: center;*/
    }

    .input-pair-wrap .first-word {
        font-size: 1.5em;
        text-align: right;
        flex-direction: column;
        width: 50%;
        word-break: initial;
        display: flex;
        justify-content: center;
    }

    .input-pair-wrap .second-word {
        /*width: 50%;*/
        word-break: initial;
    }

    .input-pair-wrap .second-word label {
        font-size: 1.35em;
        line-height: 1.6em;
        color: black;
    }

    .input-word {
        font: initial !important;
        width: 7em;
        height: auto !important;
        border-radius: 3px !important;
        margin-left: 0px !important;
        max-width: 50%;
        font-size: 1.4em !important;
        padding: 1px 6px !important;
        font-family: "Open Sans", Verdana, Geneva, sans-serif, sans-serif !important;
    }

    .restart-button {

    }

    .answer-inputs-wrap {
        margin: 0 auto;
        width: fit-content;
        text-align: right;
    }


    .correct:after {
        color: #009b00;
        font-size: 1.5em;
        content: "\f00c";
        font-family: FontAwesome;
        /*position: absolute;*/
        /*vertical-align: -75%;*/
        margin: 0px 10px;
    }

    .incorrect:after {
        color: red;
        font-size: 1.5em;
        content: "\f00d";
        margin: 0px 10px;
        /*position: absolute;*/
        font-family: FontAwesome;
        /*vertical-align: -75%;*/
    }

    .result-words-block {
    }

    .result-wrap-words {
        max-width: 100%;
        /*width: max-content;*/
        width: fit-content;
        margin: 0 auto;

    }

    .result-wrap-words-tr {
        display: flex;
        align-items: center;
        padding: 8px 40px;
    }


    .result-wrap-words-td-first {
        width: 220px;
        font-size: 130%;
        word-break: initial;
    }

    .result-wrap-words-td-second {
        /*padding: 10px;*/
        font-size: 130%;
        min-width: 100px;
        padding-left: 4px;
    }

    .result-wrap-words-td-third {
        font-size: 130%;
        color: #037203;
        word-break: initial;
    }

    .result-wrap-words .result-wrap-words-tr:nth-child(odd) { /*even*/
        background-color: #24b3f033;
    }

    .transcript-result-block {
        padding: 10px;
    }

    @media screen and (max-width: 468px) {
        .result-wrap-words {
            width: auto;
        }

        .result-wrap-words-tr {

            flex-direction: column;
            padding: 8px 10px;
        }

        .result-wrap-words-td-first {
            text-align: center;
            width: 100%;
        }
    }


</style>

<script type="text/javascript">

    const language = "ru";

    var translations = {
        en: {
            start_btn_label: "Start test now",
            start_series_label: "Start",
            reset_btn_label: "Restart",
            check_btn_label: "Check",
            series_a_label: "Series A",
            series_a_start_text: "Series А.  You will be presented with a list of a couple of words that have a logical connection. Try to memorize them in pairs. ",
            series_b_start_text: "Series B. You will be presented with a list of a couple of words that have no logical connection.",
            series_start_text_1: "During playback, memorize the words, but do NOT record. Your task is to reproduce the second word, upon presentation of the first.",
            series_start_text_2: "The correct answer is only verbatim reproduction, and NOT synonyms or words of similar meaning.",

            series_b_label: "Series B",
            instruction_text: "The “Semantic Memory” technique is aimed at diagnosing the amount of logical and mechanical memory. You will be presented a list with two series of words. In the A series of words, the words have a logical connection. And in series B, words may not be related to each other. Your task is to memorize as many pairs of words as possible. Each pair will appear on the screen for a few seconds and then disappear. After you memorize all the pairs of words, you will be asked to play the second word with the first known. Then you continue the exercise with the second set of words. Memorize the words, and then reproduce the second word of the pair with the first known.",
            instruction_label: "Instruction",
            delay_label: "You start through",
            check_block_instruction: "Add the second word:",
            result_label: "Results:",
            logical_memory_label: "The volume of the logical memory",
            mechanical_memory_label: "The volume of mechanical memory",
            coeff_logical_memory_label: "Logical memory ratio",
            your_result_label: "Your result",
            coeff_mechanical_memory_label: "Mechanical memory ratio",
            true_reproduced_words_label: "True reproduced words",
            start_second_btn_label: "Go to the second series",

            series_a_low: "Low index of logical memory volume. It is difficult for you to memorize logically related texts. To improve performance requires constant training. Start reading and retelling texts, and also learn poems.",
            series_a_medium: "The average index of logical memory volume. If there is an initial associative link, then it is easier for you to memorize the material. When you strive to form strong associative materials: remembering the new material, associate it with the previously saved.",
            series_a_high: "High index of logical memory volume. You easily remember logically related materials and have strong associative links.",

            series_b_low: "Low index of mechanical memory volume. It is difficult for you to memorize logically related texts. To improve performance, constant training is needed to memorize logically unrelated materials.",
            series_b_medium: "The average index of the volume of mechanical memory.",
            series_b_high: "High index of mechanical memory. You can easily remember and accurately reproduce logically unrelated information!",

        },
        ru: {
            start_btn_label: "Начать",
            start_series_label: "Начать серию",
            reset_btn_label: "Начать заново",
            check_btn_label: "Проверить",
            series_a_label: "Серия А",
            series_a_start_text: "Серия А.  Вам будут предъявлены пары слов, которые имеют логическую связь. Постарайтесь запомнить их попарно. ",
            series_b_start_text: "Серия Б.  Вам будут предъявлены пары слов, которые не имеют логической связи.",
            series_start_text_1: "Во время воспроизведения запоминайте слова, но НЕ записывайте. Ваша задача – воспроизвести второе слово, при предъявлении первого.",
            series_start_text_2: "Правильным ответом считается только дословное воспроизведение, а НЕ синонимы или слова схожие по смыслу.",

            series_b_label: "Серия Б",
            instruction_text: "Методика «Смысловая память» направлена на диагностику объема логической и механической памяти. Вам будет представлено две серии слов. В серии А слова представленные слова имеют логическую связь, а в серии Б слова могут быть никак не связанны друг с другом.  Ваша задача запомнить как можно большее количество пар слов.  Каждая пара будет появляться на экране на несколько секунд, а затем исчезать. После того как Вы запомните все пары слов вам будет предложено воспроизвести второе слово при известном первом. После чего Вы продолжите упражнение со вторым набором слов. Запомните слова, а потом воспроизвести второе слово из пары при известном первом.",
            instruction_label: "Инструкция",
            delay_label: "Начинаем через",
            check_block_instruction: "Допишите второе слово:",
            result_label: "Результаты:",
            logical_memory_label: "Объем логической памяти",
            mechanical_memory_label: "Объем механической памяти",
            coeff_logical_memory_label: "Коэффициент логической памяти",
            your_result_label: "Ваш результат",
            coeff_mechanical_memory_label: "Коэффициент механической памяти",
            true_reproduced_words_label: "Верно воспроизведенных слов",
            start_second_btn_label: "Перейти ко второй серии",

            series_a_low: "Низкий показатель коэффициента объема логической памяти. Вам сложно запоминать логически связанные тексты. Для улучшения показателей необходима постоянная тренировка. Начните читать и пересказывать тексты, а также учите стихи.",
            series_a_medium: "Средний показатель коэффициента объема логической памяти. Если существует изначальная ассоциативная связь, то Вам легче запоминать материал. Стремитесь формировать крепкие ассоциативные материалы: запоминая новый материал, связывайте его с ранее сохраненным.",
            series_a_high: "Высокий показатель коэффициента объема логической памяти. Вы с легкостью запоминаете логически связанные материалы и обладаете крепкими ассоциативными связями.",

            series_b_low: "Низкий показатель коэффициента объема механической памяти. Вам сложно запоминать логически связанные тексты. Для улучшения показателей необходима постоянная тренировка заучивания логически несвязанных материалов.",
            series_b_medium: "Ссредний показатель коэффициента объема механической памяти.",
            series_b_high: "Высокий показатель коэффициента объема механической памяти. Вы с легкостью запоминаете и точно воспроизводите логически несвязанную информацию!",

        }
    };

    var user_labels = translations[language];

    let series_A_lib_translations = {
        ru: {
            a_word_0: {
                w1: "машина",
                w2: "ехать",
                required: "w2"
            },
            a_word_1: {
                w1: "кружка",
                w2: "пить",
                required: "w2"
            },
            a_word_2: {
                w1: "ручка",
                w2: "писать",
                required: "w2"
            },
            a_word_3: {
                w1: "ботинки",
                w2: "шнурки",
                required: "w2"
            },
            a_word_4: {
                w1: "кот",
                w2: "молоко",
                required: "w2"
            },
            a_word_5: {
                w1: "зима",
                w2: "снеговик",
                required: "w2"
            },
            a_word_6: {
                w1: "свеча",
                w2: "гореть",
                required: "w2"
            },
            a_word_7: {
                w1: "очки",
                w2: "видеть",
                required: "w2"
            },
            a_word_8: {
                w1: "утюг",
                w2: "гладить",
                required: "w2"
            },
            a_word_9: {
                w1: "дерево",
                w2: "лист",
                required: "w2"
            },
            a_word_10: {
                w1: "помидор",
                w2: "овощ",
                required: "w2"
            },
            a_word_11: {
                w1: "рыцарь",
                w2: "защищать",
                required: "w2"
            },
            a_word_12: {
                w1: "армия",
                w2: "солдат",
                required: "w2"
            },
            a_word_13: {
                w1: "кирпич",
                w2: "строить",
                required: "w2"
            },
            a_word_14: {
                w1: "кастрюля",
                w2: "варить",
                required: "w2"
            },
            a_word_15: {
                w1: "стул",
                w2: "сидеть",
                required: "w2"
            },
            a_word_16: {
                w1: "лопата",
                w2: "яма",
                required: "w2"
            },
            a_word_17: {
                w1: "утро",
                w2: "рассвет",
                required: "w2"
            },
            a_word_18: {
                w1: "время",
                w2: "часы",
                required: "w2"
            },
            a_word_19: {
                w1: "телефон",
                w2: "звонок",
                required: "w2"
            },
            a_word_20: {
                w1: "газ",
                w2: "тормоз",
                required: "w2"
            },
            a_word_21: {
                w1: "свинья",
                w2: "поросенок",
                required: "w2"
            },
            a_word_22: {
                w1: "гитара",
                w2: "струна",
                required: "w2"
            },
            a_word_23: {
                w1: "страна",
                w2: "город",
                required: "w2"
            },
            a_word_24: {
                w1: "собака",
                w2: "щенок",
                required: "w2"
            },
            a_word_25: {
                w1: "рука",
                w2: "локоть",
                required: "w2"
            },
            a_word_26: {
                w1: "ключ",
                w2: "замок",
                required: "w2"
            },
            a_word_27: {
                w1: "соль",
                w2: "перец",
                required: "w2"
            },
            a_word_28: {
                w1: "галстук",
                w2: "бабочка",
                required: "w2"
            },
            a_word_29: {
                w1: "врач",
                w2: "халат",
                required: "w2"
            },
            a_word_30: {
                w1: "зачет",
                w2: "экзамен",
                required: "w2"
            },
            a_word_31: {
                w1: "лето",
                w2: "море",
                required: "w2"
            },
            a_word_32: {
                w1: "карта",
                w2: "искать",
                required: "w2"
            }
        },
        en: {
            a_word_0: {
                w1: "car",
                w2: "drive",
                required: "w2"
            },
            a_word_1: {
                w1: "Cup",
                w2: "drink",
                required: "w2"
            },
            a_word_2: {
                w1: "pen",
                w2: "write",
                required: "w2"
            },
            a_word_3: {
                w1: "boots",
                w2: "bootlace",
                required: "w2"
            },
            a_word_4: {
                w1: "cat",
                w2: "milk",
                required: "w2"
            },
            a_word_5: {
                w1: "winter",
                w2: "snowman",
                required: "w2"
            },
            a_word_6: {
                w1: "candle",
                w2: "burn",
                required: "w2"
            },
            a_word_7: {
                w1: "glasses",
                w2: "see",
                required: "w2"
            },
            a_word_8: {
                w1: "clothes",
                w2: "ironing",
                required: "w2"
            },
            a_word_9: {
                w1: "tree",
                w2: "leaf",
                required: "w2"
            },
            a_word_10: {
                w1: "tomato",
                w2: "vegetable",
                required: "w2"
            },
            a_word_11: {
                w1: "knight",
                w2: "defend",
                required: "w2"
            },
            a_word_12: {
                w1: "army",
                w2: "soldier",
                required: "w2"
            },
            a_word_13: {
                w1: "brick",
                w2: "build",
                required: "w2"
            },
            a_word_14: {
                w1: "casserole",
                w2: "cook",
                required: "w2"
            },
            a_word_15: {
                w1: "chair",
                w2: "sit",
                required: "w2"
            },
            a_word_16: {
                w1: "shovel",
                w2: "pit",
                required: "w2"
            },
            a_word_17: {
                w1: "morning",
                w2: "sunrise",
                required: "w2"
            },
            a_word_18: {
                w1: "time",
                w2: "clock",
                required: "w2"
            },
            a_word_19: {
                w1: "phone",
                w2: "ring",
                required: "w2"
            },
            a_word_20: {
                w1: "gas",
                w2: "brake",
                required: "w2"
            },
            a_word_21: {
                w1: "pig",
                w2: "boar",
                required: "w2"
            },
            a_word_22: {
                w1: "guitar",
                w2: "string",
                required: "w2"
            },
            a_word_23: {
                w1: "country",
                w2: "city",
                required: "w2"
            },
            a_word_24: {
                w1: "dog",
                w2: "puppy",
                required: "w2"
            },
            a_word_25: {
                w1: "arm",
                w2: "elbow",
                required: "w2"
            },
            a_word_26: {
                w1: "key",
                w2: "lock",
                required: "w2"
            },
            a_word_27: {
                w1: "salt",
                w2: "pepper",
                required: "w2"
            },
            a_word_28: {
                w1: "tie",
                w2: "bow",
                required: "w2"
            },
            a_word_29: {
                w1: "doctor",
                w2: "gown",
                required: "w2"
            },
            a_word_30: {
                w1: "test",
                w2: "exam",
                required: "w2"
            },
            a_word_31: {
                w1: "summer",
                w2: "sea",
                required: "w2"
            },
            a_word_32: {
                w1: "map",
                w2: "search",
                required: "w2"
            }
        }

    };

    let series_B_lib_translations = {
        ru: {
            b_word_0: {
                w1: "слон",
                w2: "автобус",
                required: "w2"
            },
            b_word_1: {
                w1: "брюки",
                w2: "небо",
                required: "w2"
            },
            b_word_2: {
                w1: "ключи",
                w2: "город",
                required: "w2"
            },
            b_word_3: {
                w1: "вилка",
                w2: "провод",
                required: "w2"
            },
            b_word_4: {
                w1: "сестра",
                w2: "дуб",
                required: "w2"
            },
            b_word_5: {
                w1: "бег",
                w2: "огурец",
                required: "w2"
            },
            b_word_6: {
                w1: "остров",
                w2: "пчела",
                required: "w2"
            },
            b_word_7: {
                w1: "гроза",
                w2: "отец",
                required: "w2"
            },
            b_word_8: {
                w1: "химия",
                w2: "матрас",
                required: "w2"
            },
            b_word_9: {
                w1: "корабль",
                w2: "свинья",
                required: "w2"
            },
            b_word_10: {
                w1: "железо",
                w2: "голова",
                required: "w2"
            },
            b_word_11: {
                w1: "часы",
                w2: "звезда",
                required: "w2"
            },
            b_word_12: {
                w1: "краска",
                w2: "водопад",
                required: "w2"
            },
            b_word_13: {
                w1: "осанка",
                w2: "корона",
                required: "w2"
            },
            b_word_14: {
                w1: "самолет",
                w2: "камень",
                required: "w2"
            },
            b_word_15: {
                w1: "десерт",
                w2: "собор",
                required: "w2"
            },
            b_word_16: {
                w1: "спорт",
                w2: "мороз",
                required: "w2"
            },
            b_word_17: {
                w1: "мамонт",
                w2: "круг",
                required: "w2"
            },
            b_word_18: {
                w1: "горох",
                w2: "брат",
                required: "w2"
            },
            b_word_19: {
                w1: "лампа",
                w2: "круг",
                required: "w2"
            },
            b_word_20: {
                w1: "мышь",
                w2: "кулак",
                required: "w2"
            },
            b_word_21: {
                w1: "щука",
                w2: "ботинок",
                required: "w2"
            },
            b_word_22: {
                w1: "крот",
                w2: "поезд",
                required: "w2"
            },
            b_word_23: {
                w1: "зеркало",
                w2: "краб",
                required: "w2"
            },
            b_word_24: {
                w1: "карман",
                w2: "крыша",
                required: "w2"
            },
            b_word_25: {
                w1: "капуста",
                w2: "пояс",
                required: "w2"
            },
            b_word_26: {
                w1: "шапка",
                w2: "март",
                required: "w2"
            },
            b_word_27: {
                w1: "враг",
                w2: "кот",
                required: "w2"
            },
            b_word_28: {
                w1: "алмаз",
                w2: "книга",
                required: "w2"
            },
            b_word_29: {
                w1: "стрела",
                w2: "люстра",
                required: "w2"
            },
            b_word_30: {
                w1: "жаба",
                w2: "носок",
                required: "w2"
            },
            b_word_31: {
                w1: "зуб",
                w2: "дом",
                required: "w2"
            },
            b_word_32: {
                w1: "завтрак",
                w2: "теннис",
                required: "w2"
            }
        },
        en: {
            b_word_0: {
                w1: "elephant",
                w2: "bus",
                required: "w2"
            },
            b_word_1: {
                w1: "pants",
                w2: "sky",
                required: "w2"
            },
            b_word_2: {
                w1: "keys",
                w2: "town",
                required: "w2"
            },
            b_word_3: {
                w1: "fork",
                w2: "wire",
                required: "w2"
            },
            b_word_4: {
                w1: "sister",
                w2: "oak",
                required: "w2"
            },
            b_word_5: {
                w1: "run",
                w2: "cucumber",
                required: "w2"
            },
            b_word_6: {
                w1: "island",
                w2: "bee",
                required: "w2"
            },
            b_word_7: {
                w1: "storm",
                w2: "father",
                required: "w2"
            },
            b_word_8: {
                w1: "chemistry",
                w2: "mattress",
                required: "w2"
            },
            b_word_9: {
                w1: "boat",
                w2: "pig",
                required: "w2"
            },
            b_word_10: {
                w1: "iron",
                w2: "head",
                required: "w2"
            },
            b_word_11: {
                w1: "clock",
                w2: "star",
                required: "w2"
            },
            b_word_12: {
                w1: "paint",
                w2: "waterfall",
                required: "w2"
            },
            b_word_13: {
                w1: "posture",
                w2: "crown",
                required: "w2"
            },
            b_word_14: {
                w1: "plane",
                w2: "stone",
                required: "w2"
            },
            b_word_15: {
                w1: "dessert",
                w2: "cathedral",
                required: "w2"
            },
            b_word_16: {
                w1: "sport",
                w2: "frost",
                required: "w2"
            },
            b_word_17: {
                w1: "mammoth",
                w2: "circle",
                required: "w2"
            },
            b_word_18: {
                w1: "peas",
                w2: "brother",
                required: "w2"
            },
            b_word_19: {
                w1: "lamp",
                w2: "round",
                required: "w2"
            },
            b_word_20: {
                w1: "mouse",
                w2: "fist",
                required: "w2"
            },
            b_word_21: {
                w1: "pike",
                w2: "shoe",
                required: "w2"
            },
            b_word_22: {
                w1: "mole",
                w2: "train",
                required: "w2"
            },
            b_word_23: {
                w1: "mirror",
                w2: "crab",
                required: "w2"
            },
            b_word_24: {
                w1: "pocket",
                w2: "roof",
                required: "w2"
            },
            b_word_25: {
                w1: "cabbage",
                w2: "belt",
                required: "w2"
            },
            b_word_26: {
                w1: "hat",
                w2: "March",
                required: "w2"
            },
            b_word_27: {
                w1: "enemy",
                w2: "cat",
                required: "w2"
            },
            b_word_28: {
                w1: "diamond",
                w2: "book",
                required: "w2"
            },
            b_word_29: {
                w1: "arrow",
                w2: "chandelier",
                required: "w2"
            },
            b_word_30: {
                w1: "toad",
                w2: "sock",
                required: "w2"
            },
            b_word_31: {
                w1: "tooth",
                w2: "house",
                required: "w2"
            },
            b_word_32: {
                w1: "breakfast",
                w2: "tennis",
                required: "w2"
            }
        }
    };

    let series_A_lib = series_A_lib_translations[language];
    let series_B_lib = series_B_lib_translations[language];

    var word_pairs_count = 15; //series_A_lib.length;
    var word_display_time = 1700; // millisec
    var delay_between_words = 400; // millisec
    var delay_defore_start = 3; // in sec.


    $(document).ready(function () {


        var countdownTimer = function (elem, stop_time, options, stop_func) {

            var timer = createTimer(),
                offset,
                clock,
                interval;


            clock = stop_time * 1000;
            options = options || {};
            options.delay = options.delay || 1;
            options.timer_prefix = options.timer_prefix + " " || "";

            $(elem).append(timer);

            reset();

            function createTimer() {
                var timer_div = document.createElement("div");
                timer_div.className = "timer-block";
                return timer_div;
            }


            function start() {
                if (!interval) {
                    offset = Date.now();
                    console.log(interval);
                    interval = setInterval(update, options.delay);
                }
            }

            function stop() {
                if (interval) {
                    clearInterval(interval);
                    interval = null;
                }
            }

            function reset() {
                clock = stop_time * 1000;
                render();
            }

            function update() {
                // console.log(clock);
                if (clock > 0) {
                    clock -= delta();
                } else {
                    clock = 0;
                    stop();
                    stop_func();
                }
                render();
            }

            function current_time() {
                return clock / 1000;
            }

            function render() {
                timer.innerHTML = "" + options.timer_prefix + sec2time(clock / 1000) + "";
            }

            function delta() {
                var now = Date.now(),
                    d = now - offset;
                offset = now;
                return d;
            }

            function sec2time(timeInSeconds) {
                var pad = function (num, size) {
                        return ('000' + num).slice(size * -1);
                    },
                    time = parseFloat(timeInSeconds).toFixed(3),
                    hours = Math.floor(time / 60 / 60),
                    minutes = Math.floor(time / 60) % 60,
                    seconds = Math.floor(time - minutes * 60),
                    milliseconds = time.slice(-3);

                return seconds
                // pad(minutes, 2) + ':' + pad(seconds, 2)
                // return pad(hours, 2) + ':' + pad(minutes, 2) + ':' + pad(seconds, 2) + ',' + pad(milliseconds, 3);
            }

// public API
            this.current_time = current_time;
            this.start = start;
            this.stop = stop;
            this.reset = reset;
        };

        var Stopwatch = function (elem, options) {

            var timer = createTimer(),
                offset,
                clock,
                interval;

            options = options || {};
            options.delay = options.delay || 1;

            // elem.

            $(elem).append(timer);

            reset();

            // private functions
            function createTimer() {
                var timer_div = document.createElement("div");
                timer_div.className = "timer-block";
                return timer_div;
            }


            function start() {
                if (!interval) {
                    offset = Date.now();
                    interval = setInterval(update, options.delay);
                }
            }

            function stop() {
                if (interval) {
                    clearInterval(interval);
                    interval = null;
                }
            }

            function reset() {
                clock = 0;
                render();
            }

            function update() {
                clock += delta();
                render();
            }

            function current_time() {
                return clock / 1000;
            }

            function render() {
                timer.innerHTML = "" + sec2time(clock / 1000) + "";
            }

            function delta() {
                var now = Date.now(),
                    d = now - offset;

                offset = now;
                return d;
            }

            function sec2time(timeInSeconds) {
                var pad = function (num, size) {
                        return ('000' + num).slice(size * -1);
                    },
                    time = parseFloat(timeInSeconds).toFixed(3),
                    hours = Math.floor(time / 60 / 60),
                    minutes = Math.floor(time / 60) % 60,
                    seconds = Math.floor(time - minutes * 60),
                    milliseconds = time.slice(-3);

                // return pad(minutes, 2) + ':' + pad(seconds, 2);
                return pad(hours, 2) + ':' + pad(minutes, 2) + ':' + pad(seconds, 2) + ',' + pad(milliseconds, 3);
            }

            // public API
            this.current_time = current_time;
            this.start = start;
            this.stop = stop;
            this.reset = reset;
        };

        var SemanticMemory = function (html_element) {
            let student_answer = {
                series_A: {},
                series_B: {}
            };

            let series_A = {};
            Object.keys(series_A_lib).sort(function (value) {
                return .5 - Math.random()
            }).slice(0, word_pairs_count).forEach(function (value) {
                series_A[value] = series_A_lib[value];
                student_answer.series_A[value] = '';
            });

            let series_B = {};
            Object.keys(series_B_lib).sort(function (value) {
                return .5 - Math.random()
            }).slice(0, word_pairs_count).forEach(function (value) {
                student_answer.series_B[value] = '';
                series_B[value] = series_B_lib[value]
            });


            // var countdown_timer;
            var current_series_let = "A";
            var current_series;

            $(html_element).html("");
            var instruction_div = $("<div>", {
                class: "instruction-block",
            });

            instruction_div.append("<h2><strong>" + user_labels.instruction_label + "</strong></h2>");
            instruction_div.append("<p>" + user_labels.instruction_text + "</p>");

            var task_wrap = $("<div>", {
                id: "task_wrap"
            }).hide();

            var answer_wrap = $("<div>", {
                id: "answer_wrap"
            }).hide();

            var result_wrap = $("<div>", {
                id: "result_wrap"
            }).hide();


            var before_seria_wrap = $("<div>", {
                class: "before-seria-wrap"
            }).hide();

            var countdown_timer = $("<div>",
                {
                    id: "countdown_timer"
                }).appendTo(task_wrap);

            var start_wrap = $("<div>", {
                class: "start-wrap"
            }).appendTo(instruction_div);

            var start_button = $("<button>", {
                class: "start-button",
                html: user_labels.start_btn_label
            }).appendTo(start_wrap);


            startTask();

            function startTask() {

                $(html_element).append(instruction_div);
                // $(html_element).append(start_wrap);
                //
                $(html_element).append(before_seria_wrap);
                $(html_element).append(task_wrap);
                $(html_element).append(answer_wrap);
            }

            start_button.click(function () {
                startSeries();
            });

            function startSeries() {

                // $("#test_div").html("");
                task_wrap.html("");

                before_seria_wrap.html("");
                start_wrap.hide();
                task_wrap.hide();

                if (current_series_let == "A") {
                    before_seria_wrap.append("<p>" + user_labels.series_a_start_text + "</p>");
                } else {
                    before_seria_wrap.append("<p>" + user_labels.series_b_start_text + "</p>");
                }

                before_seria_wrap.append("<p>" + user_labels.series_start_text_1 + "</p>");
                before_seria_wrap.append("<p>" + user_labels.series_start_text_2 + "</p>");

                var start_seria_wrap = $("<div>", {
                    class: "start-wrap"
                }).appendTo(before_seria_wrap);

                var start_seria_btn = $("<button>", {
                    html: user_labels.start_series_label,
                    class: "start-button",
                }).appendTo(start_seria_wrap);

                before_seria_wrap.slideDown();
                instruction_div.slideUp();


                start_seria_btn.click(function () {

                    before_seria_wrap.slideUp();

                    var words_pair_wrap = $("<div>", {
                        id: "words_pair_wrap"
                    }).appendTo(task_wrap);

                    var words_pair = $("<div>", {
                        id: "words_pair"
                    }).appendTo(words_pair_wrap);


                    task_wrap.slideDown();

                    stopwatch_timer = new Stopwatch(countdown_timer);

                    stopwatch_timer.start();

                    if (current_series_let == "A") {
                        current_series = series_A;
                    } else {
                        current_series = series_B;
                    }

                    var countdown_timer = new countdownTimer(words_pair, delay_defore_start, {timer_prefix: user_labels.delay_label}, function () {
                        showSeries(Object.keys(current_series), 0, words_pair, word_display_time, delay_between_words)
                    });
                    countdown_timer.start();

                });


            }

            function showSeries(array, index, target, word_delay, word_pause) {

                stopwatch_timer.stop();
                stopwatch_timer.reset();
                var slideTime = 150; //Math.round(word_pause/3);
                let current_string = current_series[array[index]].w1 + " – " + current_series[array[index]].w2;
                if (array.length - index === 1) {
                    $(target).html(current_string);
                    $(target).fadeIn(slideTime);
                    stopwatch_timer.start();
                    setTimeout(function () {
                        $(target).fadeOut(slideTime);
                        createAnswerBlock();
                        stopwatch_timer.stop();
                        stopwatch_timer.reset();
                    }, word_delay);
                } else {
                    $(target).html(current_string);
                    $(target).fadeIn(slideTime);
                    stopwatch_timer.start();
                    setTimeout(function () {
                            $(target).fadeOut(slideTime);
                            stopwatch_timer.stop();
                            stopwatch_timer.reset();
                            setTimeout(function () {
                                showSeries(array, ++index, target, word_delay, word_pause);
                            }, word_pause);
                            stopwatch_timer.start();
                        },
                        word_delay
                    )
                }
            }

            function createAnswerBlock() {
                task_wrap.slideUp();
                // task_wrap.html("");
                answer_wrap.html("");
                answer_wrap.append("<p>" + user_labels.check_block_instruction + "</p>");

                var answer_inputs_wrap = $("<div>", {
                    class: "answer-inputs-wrap"
                });

                Object.keys(current_series).forEach(function (value) {
                    var input_pair_wrap = $("<div>", {
                        class: "input-pair-wrap",
                        id: value
                    });

                    var second_word = $("<div>", {
                        class: "second-word",
                        html: $("<label>", {html: current_series[value].w1 + "&nbsp;–&nbsp;"})
                    });

                    var input_word = $("<input>", {
                        class: "input-word",
                        type: "text"
                    }).appendTo(second_word);

                    input_word.on('input', function () {
                        student_answer['series_' + current_series_let][value] = input_word.val();
                        console.log(student_answer);
                    });

                    input_pair_wrap.append(second_word);
                    answer_inputs_wrap.append(input_pair_wrap);

                });
                answer_wrap.append(answer_inputs_wrap);
                var check_button_wrap = $("<div>", {
                    class: "start-wrap"
                });

                var check_button = $("<button>", {
                    html: user_labels.check_btn_label,
                    class: "check-button"
                }).appendTo(check_button_wrap);

                check_button.click(function () {
                    createResultBlock();
                });

                answer_wrap.append(check_button_wrap);

                $(html_element).append(answer_wrap);

                answer_wrap.slideDown();

            }

            function createResultBlock() {
                answer_wrap.slideUp();
                result_wrap.html("");
                result_wrap.append("<h2><strong>" + user_labels.result_label + "</strong></h2>");
                console.log(current_series);

                var grade = 0;
                var max_grade = Object.keys(current_series).length;

                function compare_words(c_w, s_w) {
                    return c_w.toLowerCase() == s_w.replace(" ", "").toLowerCase();
                }

                var result_words_block = $("<div>", {class: "result-words-block"});
                var result_wrap_words = $("<div>", {class: "result-wrap-words"}).appendTo(result_words_block);
                Object.keys(current_series).forEach(function (value, idx) {

                    var correct_word = current_series[value].w2;
                    var student_word = student_answer['series_' + current_series_let][value];

                    var correctness = compare_words(correct_word, student_word);
                    if (correctness) {
                        grade += 1;
                    }
                    var result_wrap_words_tr = $("<div>", {class: "result-wrap-words-tr"});
                    var result_wrap_words_td_first = $("<div>", {
                        class: "result-wrap-words-td-first",
                        html: current_series[value].w1 + " – " + (student_word.length > 0 ? student_word : "...")
                    }).appendTo(result_wrap_words_tr);

                    var result_wrap_words_td_status = $("<span>", {
                        class: "status " + (correctness ? "correct" : "incorrect")
                    }).appendTo(result_wrap_words_tr);

                    if (!correctness) {
                        var result_wrap_words_td_third = $("<div>", {
                            class: "result-wrap-words-td-third",
                            html: "(" + current_series[value].w2 + ")"
                        }).appendTo(result_wrap_words_tr);
                    }
                    result_wrap_words.append(result_wrap_words_tr)

                });

                result_wrap.append(result_words_block);


                var memory_volume = (grade / max_grade).toFixed(2);

                if (current_series_let == "A") {
                    var transcript_div = $("<div>", {
                        class: "transcript-result-block"
                    });
                    // transcript_div.append("<p>" + user_labels.true_reproduced_words_label + ": " + grade.toString() + "</p>");
                    transcript_div.append("<p>" + user_labels.your_result_label + ": <strong>" + memory_volume + "</strong></p>");

                    if (memory_volume <= 0.29) {
                        transcript_div.append("<p>" + user_labels.series_a_low + "</p>");
                    } else if (memory_volume > 0.29 && memory_volume < 0.6) {
                        transcript_div.append("<p>" + user_labels.series_a_medium + "</p>");
                    } else {
                        transcript_div.append("<p>" + user_labels.series_a_high + "</p>");
                    }

                    result_wrap.append(transcript_div);

                    var start_B_wrap = $("<div>", {
                        class: "start-wrap"
                    });
                    var start_button = $("<button>", {
                        html: user_labels.start_second_btn_label,
                        class: "start-button"
                    }).appendTo(start_B_wrap);

                    result_wrap.append(start_B_wrap);

                    start_button.click(function () {
                        result_wrap.slideUp();
                        current_series_let = "B";
                        startSeries();
                    });

                } else {

                    var transcript_div = $("<div>", {
                        class: "transcript-result-block"
                    });

                    // transcript_div.append("<p>" + user_labels.true_reproduced_words_label + ": " + grade.toString() );
                    transcript_div.append("<p>" + user_labels.coeff_mechanical_memory_label + ": <strong>" + memory_volume + "</strong></p>");

                    if (memory_volume <= 0.29) {
                        transcript_div.append("<p>" + user_labels.series_b_low + "</p>");
                    } else if (memory_volume > 0.29 && memory_volume < 0.6) {
                        transcript_div.append("<p>" + user_labels.series_b_medium + "</p>");
                    } else {
                        transcript_div.append("<p>" + user_labels.series_b_high + "</p>");
                    }

                    result_wrap.append(transcript_div);

                    var restart_button = $("<button>", {
                        html: user_labels.reset_btn_label
                    });

                    restart_button.click(function (event) {
                        semantic_memory = new SemanticMemory(semantic_memory_task);
                    });
                    result_wrap.append(restart_button);
                }


                $(html_element).append(result_wrap);
                result_wrap.slideDown();

            }

        };

        var semantic_memory_task = document.getElementById("semantic_memory_task");

        $("#semantic_memory_task").closest("xblock").css('overflow-x', 'initial');

        var semantic_memory = new SemanticMemory(semantic_memory_task);

    });

</script>

<div id="semantic_memory">

    <div id="semantic_memory_task"></div>

    <!--<div id="series_title"></div>-->
    <!---->
    <!--<div id="words_pair_wrap">-->
    <!--<div id="words_pair" style="display: none;"></div>-->
    <!--</div>-->

    <!--<div id="test_div"></div>-->

</div>
